# adjustedCurves

Author: Robin Denz

## Description

`adjustedCurves` is an R-Package which can be used to estimate and plot
confounder-adjusted survival curves + confidence intervals as well as
cause-specific confounder-adjusted cumulative incidence functions +
confidence intervals using a variety of methods. It provides a
convenient wrapper around existing R-Packages on the topic and adds
additional methods and functionality on top of it. Those additional
features include the calculation of adjusted restricted mean survival
times and testing whether two confounder-adjusted survival curves are
different in a given interval.

Detailed descriptions of each method can be found in the literature
cited in the documentation.

## Installation

A stable version can be installed directly from CRAN using:

``` r
install.packages("adjustedCurves")
```

The developmental version can be installed using the `devtools`
R-Package:

``` r
library(devtools)

install_github("https://github.com/RobinDenz1/adjustedCurves")
```

## Bug Reports and Feature Requests

If you encounter any bugs or have any specific feature requests, please
file an [Issue](https://github.com/RobinDenz1/adjustedCurves/issues).

## Examples

This minimal example shows how to estimate and plot adjusted survival
curves using *Direct Adjustment* with this package:

``` r
library(adjustedCurves)
library(ggplot2)
library(survival)

# simulate some data as example
set.seed(31)
sim_dat <- sim_confounded_surv(n=250, max_t=1.2, group_beta=0)
sim_dat$group <- as.factor(sim_dat$group)

# estimate a cox-regression for the outcome
cox_mod <- coxph(Surv(time, event) ~ x1 + x2 + x4 + x5 + group,
                 data=sim_dat, x=TRUE)

# use it to estimate adjusted survival curves
adjsurv <- adjustedsurv(data=sim_dat,
                        variable="group",
                        ev_time="time",
                        event="event",
                        method="direct",
                        outcome_model=cox_mod,
                        conf_int=TRUE)

# plot with confidence intervals
plot(adjsurv, conf_int=TRUE)
```

![](reference/figures/README-unnamed-chunk-4-1.png)

Here is an example of how to estimate and plot adjusted survival curves
using *Inverse Probability of Treatment Weighting*:

``` r
# estimate a treatment assignment model
glm_mod <- glm(group ~ x2 + x3 + x5 + x6, data=sim_dat,
               family="binomial"(link="logit"))

# use it to estimate adjusted survival curves
adjsurv <- adjustedsurv(data=sim_dat,
                        variable="group",
                        ev_time="time",
                        event="event",
                        method="iptw_km",
                        treatment_model=glm_mod,
                        conf_int=TRUE)

# plot with confidence intervals
plot(adjsurv, conf_int=TRUE)
```

![](reference/figures/README-unnamed-chunk-5-1.png)

It is also possible to plot the difference between two curves using the
[`plot_curve_diff()`](https://robindenz1.github.io/adjustedCurves/reference/plot_curve_diff.md)
function:

``` r
plot_curve_diff(adjsurv, conf_int=TRUE, color="blue")
```

![](reference/figures/README-unnamed-chunk-6-1.png)

To test whether the two adjusted survival curves are different in a
specified interval (here 0 to 0.75), the `adjustedsurv` call has to be
made with `bootstrap=TRUE`:

``` r
adjsurv <- adjustedsurv(data=sim_dat,
                        variable="group",
                        ev_time="time",
                        event="event",
                        method="direct",
                        outcome_model=cox_mod,
                        conf_int=TRUE,
                        bootstrap=TRUE,
                        n_boot=1000)

adj_test <- adjusted_curve_test(adjsurv, from=0, to=0.75)
summary(adj_test)
#> ------------------------------------------------------------------
#>    Test of the Difference between two adjusted Survival Curves
#> ------------------------------------------------------------------
#> 
#> Using the interval: 0 to 0.75 
#> 
#>             ABC ABC SE 95% CI (lower) 95% CI (upper) P-Value N Boot
#> 0 vs. 1 -0.0129 0.0268         -0.066         0.0401   0.616   1000
#> ------------------------------------------------------------------
```

More examples can be found in the documentation and the vignettes.

## Citation

The main paper associated with this R-Package is:

Robin Denz, Renate Klaaßen-Mielke, and Nina Timmesfeld (2023). *A
comparison of different methods to adjust survival curves for
confounders*. Statistics in Medicine. 42.10, pp. 1461-1479.
<doi:10.1002/sim.9681>

In addition, the relevant primary literature of the respective method
should be cited. This can be found in the documentation of the method.

## License

© 2024 Robin Denz

The contents of this repository are distributed under the GNU General
Public License. You can find the full text of this License in this
github repository. Alternatively, see <http://www.gnu.org/licenses/>.

# Package index

## Adjusted survival curves

Estimate and plot confounder adjusted survival curves using various
methods

- [`adjustedsurv()`](https://robindenz1.github.io/adjustedCurves/reference/adjustedsurv.md)
  : Estimate Confounder-Adjusted Survival Curves

- [`plot(`*`<adjustedsurv>`*`)`](https://robindenz1.github.io/adjustedCurves/reference/plot.adjustedsurv.md)
  : Plot Confounder-Adjusted Survival Curves

- [`surv_direct`](https://robindenz1.github.io/adjustedCurves/reference/surv_direct.md)
  : Direct Adjusted Survival Curves

- [`models_surv_direct`](https://robindenz1.github.io/adjustedCurves/reference/models_surv_direct.md)
  :

  List of supported models in `surv_direct`

- [`surv_direct_pseudo`](https://robindenz1.github.io/adjustedCurves/reference/surv_direct_pseudo.md)
  : Direct Adjusted Survival Curves using Pseudo-Values

- [`surv_iptw_km`](https://robindenz1.github.io/adjustedCurves/reference/surv_iptw_km.md)
  : Inverse Probability of Treatment Weighted Kaplan-Meier estimates

- [`surv_iptw_cox`](https://robindenz1.github.io/adjustedCurves/reference/surv_iptw_cox.md)
  : Inverse Probability of Treatment Weighted Survival using
  Cox-Regression

- [`surv_iptw_pseudo`](https://robindenz1.github.io/adjustedCurves/reference/surv_iptw_pseudo.md)
  : Inverse Probability of Treatment Weighted Survival Estimates using
  Pseudo-Values

- [`surv_matching`](https://robindenz1.github.io/adjustedCurves/reference/surv_matching.md)
  : Using Propensity-Score Matching to Calculate Adjusted Survival
  Curves

- [`surv_emp_lik`](https://robindenz1.github.io/adjustedCurves/reference/surv_emp_lik.md)
  : Empirical Likelihood Estimation Survival Curves

- [`surv_aiptw`](https://robindenz1.github.io/adjustedCurves/reference/surv_aiptw.md)
  : Augmented Inverse Probability of Treatment Weighted Survival Curves

- [`surv_aiptw_pseudo`](https://robindenz1.github.io/adjustedCurves/reference/surv_aiptw_pseudo.md)
  : Augmented Inverse Probability of Treatment Weighted Survival Curves
  using Pseudo-Values

- [`surv_strat_amato`](https://robindenz1.github.io/adjustedCurves/reference/surv_strat_amato.md)
  : Adjusted Survival Curves for Categorical Confounders using the
  Method by Amato (1988)

- [`surv_strat_nieto`](https://robindenz1.github.io/adjustedCurves/reference/surv_strat_nieto.md)
  : Adjusted Survival Curves for Categorical Confounders using the
  Method by Gregory (1988) and Nieto & Coresh (1996)

- [`surv_strat_cupples`](https://robindenz1.github.io/adjustedCurves/reference/surv_strat_cupples.md)
  : Adjusted Survival Curves for Categorical Confounders using the
  Method by Cupples et al. (1995)

- [`surv_iv_2SRIF`](https://robindenz1.github.io/adjustedCurves/reference/surv_iv_2SRIF.md)
  : Instrumental Variable based Survival Curve Estimation using the Two
  Stage Residual Inclusion method with a Frailty Term (2SRI-F)

- [`surv_prox_iptw`](https://robindenz1.github.io/adjustedCurves/reference/surv_prox_iptw.md)
  : Proximal Inverse Probability of Treatment Weighted Survival Curve
  Estimates

- [`surv_prox_aiptw`](https://robindenz1.github.io/adjustedCurves/reference/surv_prox_aiptw.md)
  : Proximal Augmented Inverse Probability of Treatment Weighted
  Survival Curve Estimates

- [`surv_km`](https://robindenz1.github.io/adjustedCurves/reference/surv_km.md)
  : Group-Specific Kaplan-Meier Survival Curves

## Adjusted cumulative incidence functions

Estimate and plot confounder adjusted cumulative incidence functions
from competing events data using various methods

- [`adjustedcif()`](https://robindenz1.github.io/adjustedCurves/reference/adjustedcif.md)
  : Estimate Cause-Specific Confounder-Adjusted Cumulative Incidence
  Functions

- [`plot(`*`<adjustedcif>`*`)`](https://robindenz1.github.io/adjustedCurves/reference/plot.adjustedcif.md)
  : Plot Confounder-Adjusted Cumulative Incidence Functions

- [`cif_direct`](https://robindenz1.github.io/adjustedCurves/reference/cif_direct.md)
  : Direct Adjusted Cumulative Incidence Functions

- [`models_cif_direct`](https://robindenz1.github.io/adjustedCurves/reference/models_cif_direct.md)
  :

  List of supported models in `cif_direct`

- [`cif_direct_pseudo`](https://robindenz1.github.io/adjustedCurves/reference/cif_direct_pseudo.md)
  : Direct Adjusted CIFs using Pseudo-Values

- [`cif_iptw`](https://robindenz1.github.io/adjustedCurves/reference/cif_iptw.md)
  : Inverse Probability of Treatment Weighted CIFs

- [`cif_iptw_pseudo`](https://robindenz1.github.io/adjustedCurves/reference/cif_iptw_pseudo.md)
  : Inverse Probability of Treatment Weighted CIFs using Pseudo-Values

- [`cif_matching`](https://robindenz1.github.io/adjustedCurves/reference/cif_matching.md)
  : Using Propensity-Score Matching to Calculate Adjusted CIFs

- [`cif_aiptw`](https://robindenz1.github.io/adjustedCurves/reference/cif_aiptw.md)
  : Augmented Inverse Probability of Treatment Weighted CIFs

- [`cif_aiptw_pseudo`](https://robindenz1.github.io/adjustedCurves/reference/cif_aiptw_pseudo.md)
  : Augmented Inverse Probability of Treatment Weighted CIFs using
  Pseudo-Values

- [`cif_aalen_johansen`](https://robindenz1.github.io/adjustedCurves/reference/cif_aalen_johansen.md)
  : Group-Specific Aalen-Johansen CIFs

## Statistics and Group Comparisons

Various Statistics and ways to compare groups based on adjusted survival
curves or CIFs

- [`adjusted_curve_diff()`](https://robindenz1.github.io/adjustedCurves/reference/adjusted_curve_diff.md)
  [`adjusted_curve_ratio()`](https://robindenz1.github.io/adjustedCurves/reference/adjusted_curve_diff.md)
  : Estimate the difference between or the ratio of two
  Confounder-Adjusted Survival Curves or CIFs

- [`adjusted_rmst()`](https://robindenz1.github.io/adjustedCurves/reference/adjusted_rmst.md)
  : Estimate Confounder-Adjusted Restricted Mean Survival Times

- [`adjusted_rmtl()`](https://robindenz1.github.io/adjustedCurves/reference/adjusted_rmtl.md)
  : Estimate Confounder-Adjusted Restricted Mean Time Lost

- [`adjusted_surv_quantile()`](https://robindenz1.github.io/adjustedCurves/reference/adjusted_surv_quantile.md)
  : Estimate Confounder-Adjusted Survival Time Quantiles

- [`adjusted_curve_test()`](https://robindenz1.github.io/adjustedCurves/reference/adjusted_curve_test.md)
  : Test if there is a difference between two Confounder-Adjusted
  Survival Curves or CIFs

- [`print(`*`<curve_test>`*`)`](https://robindenz1.github.io/adjustedCurves/reference/print.curve_test.md)
  :

  Print Method for `curve_test` Objects

- [`plot(`*`<curve_test>`*`)`](https://robindenz1.github.io/adjustedCurves/reference/plot.curve_test.md)
  :

  Plot Method for `curve_test` Objects

- [`plot_curve_diff()`](https://robindenz1.github.io/adjustedCurves/reference/plot_curve_diff.md)
  [`plot_curve_ratio()`](https://robindenz1.github.io/adjustedCurves/reference/plot_curve_diff.md)
  : Plot the Difference Between or the Ratio of Two Adjusted Survival
  Curves or CIFs

- [`plot_rmst_curve()`](https://robindenz1.github.io/adjustedCurves/reference/plot_rmst_curve.md)
  : Plot Adjusted Restricted Mean Survival Time Curves

- [`plot_rmtl_curve()`](https://robindenz1.github.io/adjustedCurves/reference/plot_rmtl_curve.md)
  : Plot Adjusted Restricted Mean Time Lost Curves

## Misc

- [`adjustedCurves-package`](https://robindenz1.github.io/adjustedCurves/reference/adjustedCurves.md)
  : Confounder-Adjusted Survival Curves and Cumulative Incidence
  Functions

- [`as_ggsurvplot_df()`](https://robindenz1.github.io/adjustedCurves/reference/as_ggsurvplot_df.md)
  :

  Extract a `data.frame` containing the estimated survival curves from a
  `adjustedsurv` object

- [`sim_confounded_surv()`](https://robindenz1.github.io/adjustedCurves/reference/sim_confounded_surv.md)
  : Simulate Survival Data with Confounders

- [`sim_confounded_crisk()`](https://robindenz1.github.io/adjustedCurves/reference/sim_confounded_crisk.md)
  : Simulate Competing Risks Data with Confounders

- [`CSC_MI()`](https://robindenz1.github.io/adjustedCurves/reference/CSC_MI.md)
  : Cause-Specific Cox Regression with Multiple Imputation

- [`FGR_MI()`](https://robindenz1.github.io/adjustedCurves/reference/FGR_MI.md)
  : Fine & Gray Model with Multiple Imputation

# Articles

### Articles

- [An Introduction to the 'adjustedCurves'
  Package](https://robindenz1.github.io/adjustedCurves/articles/adjustedCurves.md):
- [Overview of methods in
  adjustedCurves](https://robindenz1.github.io/adjustedCurves/articles/method_overview.md):
- [Customizing Adjusted Survival Curve
  Plots](https://robindenz1.github.io/adjustedCurves/articles/plot_customization.md):
- [Comparing Adjusted Survival Curves or Cumulative Incidence
  Curves](https://robindenz1.github.io/adjustedCurves/articles/comparing_groups.md):
- [Frequently Asked Questions about the adjustedCurves
  Package](https://robindenz1.github.io/adjustedCurves/articles/faq.md):
