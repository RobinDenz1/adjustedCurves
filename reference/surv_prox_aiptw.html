<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Proximal Augmented Inverse Probability of Treatment Weighted Survival Curve Estimates — surv_prox_aiptw • adjustedCurves</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Proximal Augmented Inverse Probability of Treatment Weighted Survival Curve Estimates — surv_prox_aiptw"><meta name="description" content='

This page explains the details of estimating augmented inverse probability of treatment weighted survival curves using a proximal causal inference based method for single event time-to-event data (method="prox_aiptw" as described by Ying et al. (2022) in the adjustedsurv function). All regular arguments of the adjustedsurv function can be used. Additionally, the treatment_proxy, outcome_proxy and adjust_vars arguments have to be specified in the adjustedsurv call. Further arguments specific to this method are listed below.'><meta property="og:description" content='

This page explains the details of estimating augmented inverse probability of treatment weighted survival curves using a proximal causal inference based method for single event time-to-event data (method="prox_aiptw" as described by Ying et al. (2022) in the adjustedsurv function). All regular arguments of the adjustedsurv function can be used. Additionally, the treatment_proxy, outcome_proxy and adjust_vars arguments have to be specified in the adjustedsurv call. Further arguments specific to this method are listed below.'><meta property="og:image" content="https://robindenz1.github.io/adjustedCurves/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">adjustedCurves</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.11.3.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/adjustedCurves.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/method_overview.html">Overview of methods in adjustedCurves</a></li>
    <li><a class="dropdown-item" href="../articles/plot_customization.html">Customizing Adjusted Survival Curve Plots</a></li>
    <li><a class="dropdown-item" href="../articles/comparing_groups.html">Comparing Adjusted Survival Curves or Cumulative Incidence Curves</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">Frequently Asked Questions about the adjustedCurves Package</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/adjustedCurves/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Proximal Augmented Inverse Probability of Treatment Weighted Survival Curve Estimates</h1>

      <div class="d-none name"><code>surv_prox_aiptw.Rd</code></div>
    </div>

    <div class="ref-description section level2">


<p>This page explains the details of estimating augmented inverse probability of treatment weighted survival curves using a proximal causal inference based method for single event time-to-event data (<code>method="prox_aiptw"</code> as described by Ying et al. (2022) in the <code><a href="adjustedsurv.html">adjustedsurv</a></code> function). All regular arguments of the <code>adjustedsurv</code> function can be used. Additionally, the <code>treatment_proxy</code>, <code>outcome_proxy</code> and <code>adjust_vars</code> arguments have to be specified in the <code>adjustedsurv</code> call. Further arguments specific to this method are listed below.</p>
    </div>


    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-adjust-vars">adjust_vars<a class="anchor" aria-label="anchor" href="#arg-adjust-vars"></a></dt>
<dd><p>[<strong>required</strong>] A character vector specifying names of variables in <code>data</code>. These variables may consist of observed confounders. At least one variable has to be named. Can be numeric, character or factor variables. Corresponds to \(X\) (type 1 proxy) in the article by Ying et al. (2022).</p></dd>

  <dt id="arg-treatment-proxy">treatment_proxy<a class="anchor" aria-label="anchor" href="#arg-treatment-proxy"></a></dt>
<dd><p>[<strong>required</strong>] A single character string specifying the (numeric) variable that should be used as a treatment proxy. Corresponds to \(Z\) (type 3 proxy) in the article by Ying et al. (2022).</p></dd>

  <dt id="arg-outcome-proxy">outcome_proxy<a class="anchor" aria-label="anchor" href="#arg-outcome-proxy"></a></dt>
<dd><p>[<strong>required</strong>] A single character string specifying the (numeric) variable that should be used as a outcome proxy. Corresponds to \(W\) (type 2 proxy) in the article by Ying et al. (2022).</p></dd>

  <dt id="arg-optim-method">optim_method<a class="anchor" aria-label="anchor" href="#arg-optim-method"></a></dt>
<dd><p>A single character string passed to the <code>method</code> argument of the <code>optim</code> function, used internally when fitting the q-confounding bridge function and the h-confounding bridge function. Defaults to <code>"BFGS"</code>. To pass additional argument to the internal <code>optim</code> call, see argument <code>optim_control</code>.</p></dd>

  <dt id="arg-optim-control">optim_control<a class="anchor" aria-label="anchor" href="#arg-optim-control"></a></dt>
<dd><p>A list of named arguments passed to the <code>control</code> argument of the <code>optim</code> function, used internally when fitting the q-confounding bridge function and the h-confounding bridge function. Set to <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> to not pass any additional argument (default).</p></dd>

  <dt id="arg-return-fit">return_fit<a class="anchor" aria-label="anchor" href="#arg-return-fit"></a></dt>
<dd><p>Whether to add intermediate results, such as the q-confounding bridge function to the output object. Defaults to <code>TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>


<ul><li><p><strong>Type of Adjustment:</strong> Uses the proximal causal inference framework to adjust for measured and unmeasured confounding through the use of both the q-confounding bridge function and the h-confounding bridge function, which is essentially augmented inverse probability of treatment weighting, but using proxies.</p></li>
<li><p><strong>Doubly-Robust:</strong> Estimates are Doubly-Robust in the sense that only one of the bridge functions has to be correctly specified to achieve unbiased estimates, given that the other relevant assumptions hold.</p></li>
<li><p><strong>Categorical groups:</strong><code>variable</code> may only contain two groups. Must be a factor variable.</p></li>
<li><p><strong>Approximate Variance:</strong> Calculations to approximate the variance and confidence intervals are available.</p></li>
<li><p><strong>Allowed Time Values:</strong> Allows both continuous and integer time.</p></li>
<li><p><strong>Bounded Estimates:</strong> Estimates are guaranteed to be bounded in the 0 to 1 probability range.</p></li>
<li><p><strong>Monotone Function:</strong> Estimates are not guaranteed to be monotone.</p></li>
<li><p><strong>Dependencies:</strong> Depends on <span class="pkg">numDeriv</span> and the dependencies of that package.</p></li>
</ul><p>This method is based on the proximal causal inference framework, first introduced by Miao et al. (2018) and later extended to allow for estimation of counterfactual survival curves by Ying et al. (2022). It allows the estimation of the treatment-specific counterfactual survival curve under unmeasured confounding, when the true data-generation mechanism has a particular structure. In particular, there must be an observed variable (contained in the dataset) that is a potential cause of the treatment (<code>variable</code>) and also unrelated to the time-to-event endpoint, except through measured confounders (<code>adjust_vars</code>) and a particular known but unmeasured confounder. This type of variable is called a <code>treatment_proxy</code>. Secondly, there must be another observed variable that directly or indirectly causes the outcome, but is unrelated to the treatment expect through measured confounders and the same known but unmeasured confounder as mentioned earlier. This type of variable is called an <code>outcome_proxy</code>. A better explanation is given by Zivich et al. (2023). More information on the underlying assumptions can be found in the papers listed in the references.</p>
<p>Ying et al. (2022) proposed two methods to utilize this kind of structure for the estimation of the counterfactual survival curve. The one implemented here relies on estimating the q-confounding bridge and the h-confounding bridge using parametric models. This essentially means that it uses both the treatment-assignment mechanism and the outcome-mechanism to adjust for confounding, similar to a regular augmented inverse probability weighted estimator.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Adds the following additional objects to the output of the <code>adjustedsurv</code> function:</p>
<ul><li><p><code>noncensor_cumhaz</code>: The estimated cumulative hazard function.</p></li>
<li><p><code>noncensor_cumhaz_IF</code>: The influence function based on the estimated cumulative hazard function.</p></li>
<li><p><code>q_bridge</code>: A <code>list</code> containing results from fitting the q-confounding bridge function.</p></li>
<li><p><code>h_bridge</code>: A <code>list</code> containing results from fitting the h-confounding bridge function.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Andrew Ying, Yifan Cui and Eric J. Tchetgen Tchetgen (2022). "Proximal Causal Inference for Marginal Counterfactual Survival Curves". arXiv:2204.13144</p>
<p>Wang Miao, Zhi Geng and Eric J. Tchetgen Tchetgen (2018). "Identifying Causal Effects with Proxy Variables of an Unmeasured Confounder". In: Biometrika 105.4, pp. 987-993.</p>
<p>Paul N. Zivich, Stephen R. Cole, Jessie K. Edwards, Grace E. Mulholland, Bonnie E. Shook-Sa and Eric J. Tchetgen Tchetgen (2023). "Introducing Proximal Causal Inference for Epidemiologists". In: American Journal of Epidemiology 192.7, pp. 1224-1227.</p>
<p>Eric J. Tchetgen Tchetgen, Andrew Ying, Yifan Cui, Xu Shi and Wang Miao (2020). "An Introduction to Proximal Causal Learning". arXiv:2009.10982</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Andrew Ying wrote all of the low-level estimation functions used to actually obtain the relevant values. Robin Denz wrote some wrapper functions around those to include this method in this package.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/adjustedCurves" class="external-link">adjustedCurves</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### generate some example data that fufill all assumptions ####</span></span></span>
<span class="r-in"><span><span class="co"># code was taken from the github repository associated with the original</span></span></span>
<span class="r-in"><span><span class="co"># paper by Ying et al. (2022): https://github.com/andrewyyp/Proximal_MSF</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulation parameters</span></span></span>
<span class="r-in"><span><span class="va">para_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mu_X <span class="op">=</span> <span class="fl">1.1</span>,</span></span>
<span class="r-in"><span>                 sigma_X <span class="op">=</span> <span class="fl">0.75</span>,</span></span>
<span class="r-in"><span>                 mu_U <span class="op">=</span> <span class="fl">1.1</span>,</span></span>
<span class="r-in"><span>                 sigma_U <span class="op">=</span> <span class="fl">0.75</span>,</span></span>
<span class="r-in"><span>                 alpha_A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="op">-</span><span class="fl">0.6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 mu_Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.65</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 sigma_Z <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                 mu_W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.65</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 sigma_W <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                 mu_T0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 mu_C <span class="op">=</span> <span class="fl">0.2</span>,</span></span>
<span class="r-in"><span>                 admin_C <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># small function to obtain the required data</span></span></span>
<span class="r-in"><span><span class="va">data_gen</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">para_set</span>, <span class="va">a</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># generate X, U</span></span></span>
<span class="r-in"><span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">para_set</span><span class="op">$</span><span class="va">mu_X</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">para_set</span><span class="op">$</span><span class="va">sigma_X</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="va">para_set</span><span class="op">$</span><span class="va">mu_U</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">para_set</span><span class="op">$</span><span class="va">sigma_U</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">X</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">U</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># generate A</span></span></span>
<span class="r-in"><span>    <span class="va">prop_score_0</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X</span>, <span class="va">U</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">para_set</span><span class="op">$</span><span class="va">alpha_A</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">prop_score_0</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># generate Z</span></span></span>
<span class="r-in"><span>  <span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X</span>, <span class="va">U</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">para_set</span><span class="op">$</span><span class="va">mu_Z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">para_set</span><span class="op">$</span><span class="va">sigma_Z</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># generate W</span></span></span>
<span class="r-in"><span>  <span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X</span>, <span class="va">U</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">para_set</span><span class="op">$</span><span class="va">mu_W</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">para_set</span><span class="op">$</span><span class="va">sigma_W</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#generate Y</span></span></span>
<span class="r-in"><span>  <span class="va">T0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">N</span>, rate <span class="op">=</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">A</span>, <span class="va">X</span>, <span class="va">U</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">para_set</span><span class="op">$</span><span class="va">mu_T0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">N</span>, rate <span class="op">=</span> <span class="va">para_set</span><span class="op">$</span><span class="va">mu_C</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">C</span>, <span class="va">para_set</span><span class="op">$</span><span class="va">admin_C</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">U</span>, <span class="va">A</span>, <span class="va">Z</span>, <span class="va">W</span>, T0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">T0</span>, <span class="va">C</span><span class="op">)</span>, Delta <span class="op">=</span> <span class="op">(</span><span class="va">T0</span> <span class="op">&lt;=</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">U</span>, <span class="va">A</span>, <span class="va">Z</span>, <span class="va">W</span>, T0 <span class="op">=</span> <span class="va">T0</span>, Delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Simple example ####</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4356</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># NOTE: increase N to get more stable estimates, kept low here to pass</span></span></span>
<span class="r-in"><span><span class="co">#       speed requirements set by CRAN</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">data_gen</span><span class="op">(</span>N<span class="op">=</span><span class="fl">50</span>, para_set<span class="op">=</span><span class="va">para_set</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">$</span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">A</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"numDeriv"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://optimizer.r-forge.r-project.org/" class="external-link">numDeriv</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>                    variable<span class="op">=</span><span class="st">"A"</span>,</span></span>
<span class="r-in"><span>                    ev_time<span class="op">=</span><span class="st">"T0"</span>,</span></span>
<span class="r-in"><span>                    event<span class="op">=</span><span class="st">"Delta"</span>,</span></span>
<span class="r-in"><span>                    method<span class="op">=</span><span class="st">"prox_aiptw"</span>,</span></span>
<span class="r-in"><span>                    adjust_vars<span class="op">=</span><span class="st">"X"</span>,</span></span>
<span class="r-in"><span>                    treatment_proxy<span class="op">=</span><span class="st">"Z"</span>,</span></span>
<span class="r-in"><span>                    outcome_proxy<span class="op">=</span><span class="st">"W"</span>,</span></span>
<span class="r-in"><span>                    conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adj</span>, iso_reg<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Ignoring unknown labels:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> <span style="color: #00BB00;">linetype</span> : <span style="color: #0000BB;">"Group"</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> <span style="color: #00BB00;">fill</span> : <span style="color: #0000BB;">"Group"</span></span>
<span class="r-plt img"><img src="surv_prox_aiptw-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

