<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Confounder-Adjusted Survival Time Quantiles — adjusted_surv_quantile • adjustedCurves</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Confounder-Adjusted Survival Time Quantiles — adjusted_surv_quantile"><meta name="description" content="This function can be utilized to estimate confounder-adjusted survival time quantiles, including the median survival time, given previously estimated adjusted survival curves. May also be used to estimate the difference between or ratio of two adjusted survival time quantiles."><meta property="og:description" content="This function can be utilized to estimate confounder-adjusted survival time quantiles, including the median survival time, given previously estimated adjusted survival curves. May also be used to estimate the difference between or ratio of two adjusted survival time quantiles."><meta property="og:image" content="https://robindenz1.github.io/adjustedCurves/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">adjustedCurves</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.11.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">An Introduction to the 'adjustedCurves' Package</a></li>
    <li><a class="dropdown-item" href="../articles/method_overview.html">Overview of methods in adjustedCurves</a></li>
    <li><a class="dropdown-item" href="../articles/plot_customization.html">Customizing Adjusted Survival Curve Plots</a></li>
    <li><a class="dropdown-item" href="../articles/comparing_groups.html">Comparing Adjusted Survival Curves or Cumulative Incidence Curves</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">Frequently Asked Questions about the adjustedCurves Package</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/adjustedCurves/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate Confounder-Adjusted Survival Time Quantiles</h1>

      <div class="d-none name"><code>adjusted_surv_quantile.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function can be utilized to estimate confounder-adjusted survival time quantiles, including the median survival time, given previously estimated adjusted survival curves. May also be used to estimate the difference between or ratio of two adjusted survival time quantiles.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">adjusted_surv_quantile</span><span class="op">(</span><span class="va">adjsurv</span>, p<span class="op">=</span><span class="fl">0.5</span>, conf_int<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                       conf_level<span class="op">=</span><span class="va">adjsurv</span><span class="op">$</span><span class="va">conf_level</span>,</span>
<span>                       use_boot<span class="op">=</span><span class="cn">FALSE</span>, interpolation<span class="op">=</span><span class="st">"steps"</span>,</span>
<span>                       contrast<span class="op">=</span><span class="st">"none"</span>, group_1<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                       group_2<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-adjsurv">adjsurv<a class="anchor" aria-label="anchor" href="#arg-adjsurv"></a></dt>
<dd><p>An <code>adjustedsurv</code> object created using the <code>adjustedsurv</code> function.</p></dd>

  <dt id="arg-p">p<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>The quantile of interest. To calculate the median survival time, set this parameter to 0.5 (default). Multiple values in form of a numeric vector are allowed.</p></dd>

  <dt id="arg-conf-int">conf_int<a class="anchor" aria-label="anchor" href="#arg-conf-int"></a></dt>
<dd><p>Whether to calculate confidence intervals or not. Those are calculated in the same way as the quantiles but using the confidence limit curves. This requires either that <code>conf_int=TRUE</code> or <code>bootstrap=TRUE</code> was used in the original <code>adjustedsurv</code> function call.</p></dd>

  <dt id="arg-conf-level">conf_level<a class="anchor" aria-label="anchor" href="#arg-conf-level"></a></dt>
<dd><p>A single number specifying the confidence level of the confidence intervals. By default the previously estimated confidence intervals and thereby the same confidence level that was used in the original <code>adjustedsurv</code> call will be used. If <code>conf_level</code> is set to a different value, the confidence intervals will be re-calculated first. This works for all methods except <code>method="km"</code>.</p></dd>

  <dt id="arg-use-boot">use_boot<a class="anchor" aria-label="anchor" href="#arg-use-boot"></a></dt>
<dd><p>Whether to use the bootstrap confidence interval estimates of the survival curves to estimate the confidence intervals of the survival time quantiles or not. Can only be used when <code>bootstrap=TRUE</code> was used in the original <code>adjustedsurv</code> function call. Ignored if <code>conf_int=FALSE</code>.</p></dd>

  <dt id="arg-interpolation">interpolation<a class="anchor" aria-label="anchor" href="#arg-interpolation"></a></dt>
<dd><p>Either <code>"steps"</code> (default) or <code>"linear"</code>. This parameter controls how interpolation is performed. If this argument is set to <code>"steps"</code>, the curves will be treated as step functions. If it is set to <code>"linear"</code>, the curves wil be treated as if there are straight lines between the point estimates instead. Points that lie between estimated points will be interpolated accordingly.</p></dd>

  <dt id="arg-contrast">contrast<a class="anchor" aria-label="anchor" href="#arg-contrast"></a></dt>
<dd><p>A single character string, specifying which contrast should be estimated. Needs to be one of <code>"none"</code> (estimate no contrasts, just return the adjusted survival time quantile, the default), <code>"diff"</code> (estimate the difference) or <code>"ratio"</code> (estimate the ratio). When <code>conf_int=TRUE</code> is also specified and bootstrapping was performed in the original <code>adjustedsurv</code> call, this function will also estimate the corresponding standard error, the confidence interval and a p-value testing whether the difference is equal to 0 (or the ratio is equal to 1). To specify which difference/ratio should be calculated, the <code>group_1</code> and <code>group_2</code> arguments can be used. By default, the difference/ratio between the first and second level in <code>variable</code> is computed.</p></dd>

  <dt id="arg-group-">group_1<a class="anchor" aria-label="anchor" href="#arg-group-"></a></dt>
<dd><p>Optional argument to get a specific difference or ratio. This argument takes a single character string specifying one of the levels of the <code>variable</code> used in the original <code>adjustedsurv</code> function call. This group will be subtracted from. For example if <code>group_1="A"</code> and <code>group_2="B"</code> and <code>contrast=="diff"</code> the difference <code>A - B</code> will be used. If <code>NULL</code>, the order of the factor levels in the original data determines the order. Ignored if <code>contrast="none"</code>.</p></dd>

  <dt id="arg-group-">group_2<a class="anchor" aria-label="anchor" href="#arg-group-"></a></dt>
<dd><p>Also a single character string specifying one of the levels of <code>variable</code>. This corresponds to the right side of the difference/ratio equation. See argument <code>group_2</code>. Ignored if <code>contrast="none"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>


<p>The median survival time is simply the time when half the patients are expected to be alive. The chance of surviving beyond that time is 50 percent. In general, any quantile can be calculated this way. Those can be read directly from the respective survival curve by drawing a straight line from the desired quantile <code>p</code> on the Y-Axis and reading the X-Axis value where this line intersects with the survival curve. The adjusted survival time quantile for group \(z\) (corresponding to the <code>variable</code> argument in the <code><a href="adjustedsurv.html">adjustedsurv</a></code> function) is formally defined as:</p>
<p>$$\hat{Q}_z(p) = min\left(t | \hat{S}_z(t) \leq p\right)$$</p>
<p>where \(\hat{S}_z(t)\) is the estimated counterfactual survival function for \(z\).</p>
<p>If the survival probability never drops below <code>p</code>, the survival time quantile cannot be calculated. This function calculates this quantity automatically.</p>
<p><strong><em>Confidence intervals</em></strong></p>
<p>When estimating the adjusted survival time quantiles directly, the confidence intervals are simply read off the survival curves similarly to the point estimates. For example, this means that the lower limit of the confidence interval for some survival time quantile is simply the first point in time at which the curve defined by the lower confidence limit goes below \(p\).</p>
<p>If <code>contrast="none"</code>, a different approach is used. Note that this functionality works only with bootstrapping (regardless of whether <code>use_boot</code> is <code>TRUE</code> or <code>FALSE</code>). In this case, the survival time quantiles are calculated for each bootstrap sample separately first. Afterwards, the standard deviation of the resulting estimates is calculated for each group. For differences, the pooled standard error is then estimated as \(SE_{group_1 - group_2} = \sqrt{SE_{group_1}^2 + SE_{group_2}^2}\) and used along with the normal approximation to calculate confidence intervals. This is similar to the strategy of Wu (2011). The p-value is also estimated using the pooled standard error and a one-sample two-sided t-test with the null-hypothesis that the difference is equal to 0. The confidence interval and p-value of the ratio is estimated using the method of Fieller (1954).</p>
<p>If one or both of the survival time quantiles used for the difference / ratio calculation could not be estimated from the respective bootstrap sample (due to the curves not extending that far) it is simply discarded.</p>
<p><strong><em>More than Two Groups</em></strong></p>
<p>If more than two groups are present in <code>variable</code>, all other comparisons except for <code>group_1 vs. group_2</code> are ignored. If multiple comparisons are desired, the user needs to call this function multiple times and adjust the <code>group_1</code> and <code>group_2</code> arguments accordingly.</p>
<p><strong><em>Multiple Imputation</em></strong></p>
<p>If multiple imputation was used in the original function call, the survival time quantiles are read off the final pooled survival curves directly. This also works when using <code>contrast="diff"</code> or <code>contrast="ratio"</code>. When using either <code>contrast="diff"</code> or <code>contrast="ratio"</code> in conjunction with <code>conf_int=TRUE</code> (plus bootstrapping), the standard errors of the difference or ratio are estimated for each imputed dataset separately and pooled using Rubins Rule afterwards. The pooled standard errors are then used to perform the same calculations as described above.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>


<p>Returns a <code>data.frame</code> containing the columns <code>p</code> (the quantiles from the original function call), <code>group</code> (groups in <code>variable</code>) and <code>q_surv</code> (the survival time quantile).</p>
<p>If <code>conf_int=TRUE</code> was used it also includes the confidence limits in the <code>ci_lower</code> and <code>ci_upper</code> columns.</p>
<p>If <code>contrast="diff"</code> was used, the resulting <code>data.frame</code> instead contains the columns <code>p</code> (the quantiles from the original function all) and <code>diff</code> (the difference between the two survival time quantiles). If <code>conf_int=TRUE</code> was used it additionally contains the columns <code>se</code> (the standard deviation of the bootstrap estimates), <code>ci_lower</code> and <code>ci_upper</code> (the confidence interval) and <code>n_boot</code> (the number of bootstrap samples that could be used). The output is similar when using <code>contrast="ratio"</code>, except that the <code>diff</code> column is called <code>ratio</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Omer Ben-Aharon, Racheli Magnezi, Moshe Leshno, and Daniel A. Goldstein (2019). "Median Survival or Mean Survival: Which Measure is the Most Appropriate for Patients, Physicians, and Policymakers?" In: The Oncologist 24, pp. 1469-1478</p>
<p>Zhongxue Chen and Guoyi Zhang (2016). "Comparing Survival Curves based on Medians". In: BMC Medical Research Methodology 16.33</p>
<p>Jianrong Wu (2011). "Confidence Intervals for the Difference of Median Failure Times Applied to Censored Tumor Growth Delay Data". In: Statistics in Biopharmaceutical Research 3.3, pp. 488-496</p>
<p>Edgar C. Fieller (1954). "Some Problems in Interval Estimation". In: Journal of the Royal Statistical Society, Series B 16.2, pp. 175-185</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robin Denz</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="adjustedsurv.html">adjustedsurv</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/adjustedCurves" class="external-link">adjustedCurves</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate some data as example</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_confounded_surv.html">sim_confounded_surv</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span>, max_t<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># estimate a cox-regression for the outcome</span></span></span>
<span class="r-in"><span><span class="va">cox_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span> <span class="op">+</span> <span class="va">group</span>,</span></span>
<span class="r-in"><span>                 data<span class="op">=</span><span class="va">sim_dat</span>, x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use it to calculate adjusted survival curves with bootstrapping</span></span></span>
<span class="r-in"><span><span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">sim_dat</span>,</span></span>
<span class="r-in"><span>                        variable<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                        ev_time<span class="op">=</span><span class="st">"time"</span>,</span></span>
<span class="r-in"><span>                        event<span class="op">=</span><span class="st">"event"</span>,</span></span>
<span class="r-in"><span>                        method<span class="op">=</span><span class="st">"direct"</span>,</span></span>
<span class="r-in"><span>                        outcome_model<span class="op">=</span><span class="va">cox_mod</span>,</span></span>
<span class="r-in"><span>                        conf_int<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                        bootstrap<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate adjusted median survival times</span></span></span>
<span class="r-in"><span><span class="fu">adjusted_surv_quantile</span><span class="op">(</span><span class="va">adjsurv</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     p group    q_surv</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.5     0 0.5105218</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.5     1 0.6561380</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate difference of adjusted median survival times between groups</span></span></span>
<span class="r-in"><span><span class="fu">adjusted_surv_quantile</span><span class="op">(</span><span class="va">adjsurv</span>, contrast<span class="op">=</span><span class="st">"diff"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     p       diff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.5 -0.1456162</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate other quantiles + confidence intervals</span></span></span>
<span class="r-in"><span><span class="fu">adjusted_surv_quantile</span><span class="op">(</span><span class="va">adjsurv</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     p group    q_surv  ci_lower  ci_upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.2     0 0.7408272 0.6177998 1.0331462</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.4     0 0.6083660 0.4784817 0.7015162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.2     1        NA 0.7408272        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.4     1 0.7501622 0.6177998 1.0503161</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

