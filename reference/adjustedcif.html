<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This is one of two main functions of this R-Package. It allows the user to calculate cause-specific confounder-adjusted cumulative incidence functions in the presence of competing events using a variety of different methods. Some of these methods require additional packages to be installed and, depending on the specified method, there might be additional required arguments in the function call. More information is available on the documentation page of the respective cif_method."><title>Calculate Cause-Specific Confounder-Adjusted Cumulative Incidence Functions — adjustedcif • adjustedCurves</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Cause-Specific Confounder-Adjusted Cumulative Incidence Functions — adjustedcif"><meta property="og:description" content="This is one of two main functions of this R-Package. It allows the user to calculate cause-specific confounder-adjusted cumulative incidence functions in the presence of competing events using a variety of different methods. Some of these methods require additional packages to be installed and, depending on the specified method, there might be additional required arguments in the function call. More information is available on the documentation page of the respective cif_method."><meta property="og:image" content="https://robindenz1.github.io/adjustedCurves/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">adjustedCurves</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">An Introduction to the 'adjustedCurves' Package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RobinDenz1/adjustedCurves/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate Cause-Specific Confounder-Adjusted Cumulative Incidence Functions</h1>
      
      <div class="d-none name"><code>adjustedcif.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is one of two main functions of this R-Package. It allows the user to calculate cause-specific confounder-adjusted cumulative incidence functions in the presence of competing events using a variety of different methods. Some of these methods require additional packages to be installed and, depending on the specified method, there might be additional required arguments in the function call. More information is available on the documentation page of the respective <code>cif_method</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">adjustedcif</span><span class="op">(</span><span class="va">data</span>, <span class="va">variable</span>, <span class="va">ev_time</span>, <span class="va">event</span>, <span class="va">cause</span>,</span>
<span>            <span class="va">method</span>, conf_int<span class="op">=</span><span class="cn">FALSE</span>, conf_level<span class="op">=</span><span class="fl">0.95</span>,</span>
<span>            times<span class="op">=</span><span class="cn">NULL</span>, bootstrap<span class="op">=</span><span class="cn">FALSE</span>, n_boot<span class="op">=</span><span class="fl">500</span>,</span>
<span>            n_cores<span class="op">=</span><span class="fl">1</span>, na.action<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">na.action</span>,</span>
<span>            clean_data<span class="op">=</span><span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A <code>data.frame</code> object containing the needed time-to-event data in standard format. Can also be a <code>mids</code> object created with the <span class="pkg">mice</span> package. See details for how this works.</p></dd>

  <dt>variable</dt>
<dd><p>A character string specifying the variable by which the cumulative incidence functions should be grouped. Must be a valid column name of <code>data</code>. The variable specified should needs to be a factor variable.</p></dd>

  <dt>ev_time</dt>
<dd><p>A character string specifying the variable indicating the time-to-event or time-to-censoring. Must be a valid column name of <code>data</code>.</p></dd>

  <dt>event</dt>
<dd><p>A character string specifying the numeric event indicator. The censoring indicator should be coded as 0 and all other events of interest as 1, 2, etc. Must be a valid column name of <code>data</code>.</p></dd>

  <dt>cause</dt>
<dd><p>The cause of interest for which the cumulative incidence functions should be calculated. Should be a number that appears in the <code>event</code> column of <code>data</code>.</p></dd>

  <dt>method</dt>
<dd><p>A character string specifying the adjustment method to use. Case sensitive. See details.</p></dd>

  <dt>conf_int</dt>
<dd><p>A logical variable, indicating whether the asymptotic variances and confidence intervals of the cumulative incidence should be calculated. Not available for all methods. More information can be found in the documentation of each method. For an alternative way to get confidence intervals, see the <code>bootstrap</code> argument.</p></dd>

  <dt>conf_level</dt>
<dd><p>A number specifying the confidence level of asymptotic and/or bootstrap confidence intervals.</p></dd>

  <dt>times</dt>
<dd><p>A numeric vector of time points at which the cumulative incidences should be estimated or <code>NULL</code>. If <code>NULL</code> the cumulative incidence is estimated at all points in time at which any event occurred in the pooled sample.</p></dd>

  <dt>bootstrap</dt>
<dd><p>A logical variable indicating whether bootstrapping should be performed or not. In bootstrapping, a number of simple random samples with replacement of size <code>nrow(data)</code> are drawn from <code>data</code>. For each sample the calculations are repeated and used to estimate standard errors and confidence intervals. This can be used to obtain confidence intervals when asymptotic variance calculations are not available.</p></dd>

  <dt>n_boot</dt>
<dd><p>Number of bootstrap replications to perform. Ignored if <code>bootstrap</code> is <code>FALSE</code>.</p></dd>

  <dt>n_cores</dt>
<dd><p>The number of cores to use when calculating bootstrap estimates. Ignored if <code>bootstrap=FALSE</code>. Is set to 1 by default, resulting in single threaded processing. Internally uses the <span class="pkg">doParallel</span> package if <code>n_cores &gt; 1</code>. In that case it also uses the <span class="pkg">doRNG</span> package to make the results replicable. See <code><a href="https://rdrr.io/pkg/doRNG/man/infoDoRNG.html" class="external-link">?doRNG</a></code> and <code>?doParallel</code> for more details. Using multiple cores will speed up the calculation considerably in most cases.</p></dd>

  <dt>na.action</dt>
<dd><p>How missing values should be handled. Can be one of: na.fail, na.omit, na.pass or na.exclude. Also accepts strings of the function names. See <code><a href="https://rdrr.io/r/stats/na.action.html" class="external-link">?na.action</a></code> for more details. By default it uses the na.action which is set in the global options by the respective user.</p></dd>

  <dt>clean_data</dt>
<dd><p>If <code>TRUE</code> all columns which are not needed for the estimation are removed from <code>data</code> before any further calculations are performed. This ensures that calls to <code>na.omit</code> (see argument <code>na.action</code>) do not remove rows which are fully observed in respect to relevant columns due to missing values in irrelevant columns. Set to <code>FALSE</code> to skip this step. Usually this argument can be ignored. When using non-standard outcome models however it should be set to <code>FALSE</code>.</p></dd>

  <dt>...</dt>
<dd><p>Further arguments passed to the respective <code>cif_method</code>. For example when using <code>method="direct"</code> all further arguments are passed to the <code>cif_direct</code> function. See details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The primary purpose of the <code>adjustedcif</code> function is to provide a convenient way to calculate confounder-adjusted cumulative incidence functions using any of the methods provided in the literature. A <code><a href="plot.adjustedcif.html">plot</a></code> method is provided to graphically display the estimated cumulative incidence functions as well. Currently the following methods can be used:</p>
<ul><li><p>"<a href="cif_direct.html">direct</a>": Direct Standardization based on a model describing the outcome mechanism (<code><a href="https://rdrr.io/pkg/riskRegression/man/CSC.html" class="external-link">CSC</a></code>, <code><a href="https://rdrr.io/pkg/riskRegression/man/FGR.html" class="external-link">FGR</a></code>, ..).</p></li>
<li><p>"<a href="cif_direct_pseudo.html">direct_pseudo</a>": Direct Standardization based on Pseudo-Values.</p></li>
<li><p>"<a href="cif_iptw.html">iptw</a>": A weighted Aalen-Johansen estimator.</p></li>
<li><p>"<a href="cif_iptw_pseudo.html">iptw_pseudo</a>": A weighted estimator based on Pseudo-Values.</p></li>
<li><p>"<a href="cif_matching.html">matching</a>": Using Propensity Score Matching to estimate the adjusted CIFs.</p></li>
<li><p>"<a href="cif_aiptw.html">aiptw</a>": An Augmented Inverse Probability of Treatment Weighting estimator.</p></li>
<li><p>"<a href="cif_aiptw_pseudo.html">aiptw_pseudo</a>": An Augmented Inverse Probability of Treatment Weighting estimator using Pseudo-Values.</p></li>
<li><p>"<a href="cif_aalen_johansen.html">aalen_johansen</a>": A simple stratified Aalen-Johansen estimator without any form of adjustment.</p></li>
</ul><p>A short description of each method is contained in the documentation of the respective <code>cif_method</code> function. For more detailed descriptions the cited literature in that same documentation can be used. The documentation for <code>method="direct"</code> for example can be accessed using <code><a href="cif_direct.html">?cif_direct</a></code>.</p>
<p><strong><em>Required &amp; Optional Arguments</em></strong></p>
<p>Every method requires the specification of the <code>data</code>, <code>variable</code>, <code>ev_time</code>, <code>event</code>, <code>cause</code> and <code>method</code> arguments. All other arguments mentioned on this page are optional and work for all methods. Depending on the method used, other arguments are required as well. Those can be found on the top of the help page of the respective method. The help pages also list additional optional arguments.</p>
<p><strong><em>Confidence Intervals</em></strong></p>
<p>For most methods approximations for the asymptotic variance of point estimates of the CIF have been proposed in the literature. Where available, those can be calculated and added to the output object using <code>conf_int=TRUE</code>. It is however recommended to use bootstrapping to estimate the variance instead, which can be done by setting <code>bootstrap=TRUE</code>. The <code>n_boot</code> argument is set to 500 by default. This number was chosen because it worked well in simulations but it does not guarantee convergence in practice. Users are recommended to inspect the bootstrapped estimates and adjust the number of replications accordingly. To allow faster bootstrapping the user can choose to run the function on multiple CPU cores in parallel using the <code>n_cores</code> argument.</p>
<p><strong><em>Missing Data</em></strong></p>
<p>There are two ways to deal with missing data using this function. The first is using the <code>na.action</code> argument. It simply calls the respective <code>na.action</code> function on the data before doing any further processing. By using <code>na.action="na.omit"</code> for example, only rows with complete data are kept for the analysis.</p>
<p>Alternatively, this function also supports the use of multiple imputation via the <span class="pkg">mice</span> package. Instead of supplying a single data.frame, the user should create a <code>mids</code> object using the <code>mice</code> function and directly pass this to the <code>data</code> argument. When methods are used which rely on previously estimated treatment or outcome models such as <code>"direct"</code> or <code>"aiptw"</code>, the user is required to supply a <code>mira</code> object instead of a single model. In other words: the models have to be fit on every imputed dataset before supplying them to this function. See <code><a href="https://amices.org/mice/reference/mice.html" class="external-link">?mice</a></code> and the associated documentation for more information on how to use multiple imputation. When using <code>bootstrap=TRUE</code> and multiple imputation, the bootstrapping is performed on every imputed dataset separately. Cumulative Incidences are simply averaged across the imputed datasets according to Rubins Rule. Confidence intervals are calculated by first averaging the standard errors over all imputed datasets and afterwards using this pooled value to obtain a new confidence interval with the normal approximation. This method has only been tested with missing values in covariates. It is not clear how good this works with missing values in <code>ev_time</code> or <code>event</code> so users should be cautious in those cases.</p>
<p><strong><em>Competing Risks</em></strong></p>
<p>This function is meant to be used for data containing multiple competing risks. If the data does not contain competing-events, it is recommended to use the <code>adjustedsurv</code> function instead. It does not calculate the CIF directly, but the CIF can be calculated from the survival using CIF = 1 - \(S(t)\). This can be done automatically in the <code>plot.adjustedsurv</code> function using <code>cif=TRUE</code>.</p>
<p><strong><em>Graphical Displays</em></strong></p>
<p>A general plot of the estimated adjusted CIFs can be obtained using the associated <code><a href="plot.adjustedcif.html">plot</a></code> method. In addition, a plot of the difference between two estimated adjusted CIFs can be produced using the <code><a href="plot_curve_diff.html">plot_curve_diff</a></code> function.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns an <code>adjustedcif</code> object containing the following objects:</p>
<dl><dt>adjcif</dt>
<dd><p>A <code>data.frame</code> of estimated cumulative incidences for <code>cause</code> at some points in time for each level of <code>variable</code>. Depending on the arguments used also includes standard errors and confidence intervals.</p></dd>

<dt>method</dt>
<dd><p>The method used to adjust the CIFs.</p></dd>

<dt>categorical</dt>
<dd><p>Whether there are more than 2 groups in <code>variable</code>.</p></dd>

<dt>call</dt>
<dd><p>The original function call.</p></dd>


</dl><p>When the argument <code>bootstrap</code> is set to <code>TRUE</code> it additionally contains the following objects:</p>
<dl><dt>boot_data</dt>
<dd><p>The adjusted CIFs estimated in each bootstrap sample.</p></dd>

<dt>boot_adjcif</dt>
<dd><p>The mean CIFs of all bootstrap samples and corresponding standard errors and percentile confidence intervals.</p></dd>


</dl><p>When multiple imputation was used, the function additionally contains a <code>mids_analyses</code> object, containing the <code>adjustedcif</code> objects for each imputed dataset.</p>


<p>Some method specific objects might also be contained in the output.</p>


    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Robin Denz, Renate Klaaßen-Mielke, and Nina Timmesfeld (2023). "A Comparison of Different Methods to Adjust Survival Curves for Confounders". In: Statistics in Medicine 42.10, pp. 1461-1479</p>
<p>More relevant literature can be found in the respective <code>cif_method</code> documentation.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>The function itself was written by Robin Denz, but some <code>cif_method</code> functions include wrappers for functions written by other people. More information can be found in the respective <code>cif_method</code> documentation.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plot.adjustedcif.html">plot.adjustedcif</a></code>, <code><a href="adjusted_rmtl.html">adjusted_rmtl</a></code>, <code><a href="plot_curve_diff.html">plot_curve_diff</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/adjustedCurves" class="external-link">adjustedCurves</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tagteam/riskRegression" class="external-link">riskRegression</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate some example data</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_confounded_crisk.html">sim_confounded_crisk</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span>, max_t<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># treatment assignment model</span></span></span>
<span class="r-in"><span><span class="va">glm_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span>, data<span class="op">=</span><span class="va">sim_dat</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># outcome model</span></span></span>
<span class="r-in"><span><span class="va">cox_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/riskRegression/man/CSC.html" class="external-link">CSC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/Hist.html" class="external-link">Hist</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">sim_dat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using direct adjustment with asymptotic confidence intervals for cause 1</span></span></span>
<span class="r-in"><span><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu">adjustedcif</span><span class="op">(</span>data<span class="op">=</span><span class="va">sim_dat</span>,</span></span>
<span class="r-in"><span>                      variable<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                      ev_time<span class="op">=</span><span class="st">"time"</span>,</span></span>
<span class="r-in"><span>                      event<span class="op">=</span><span class="st">"event"</span>,</span></span>
<span class="r-in"><span>                      cause<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                      method<span class="op">=</span><span class="st">"direct"</span>,</span></span>
<span class="r-in"><span>                      outcome_model<span class="op">=</span><span class="va">cox_mod</span>,</span></span>
<span class="r-in"><span>                      conf_int<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                      bootstrap<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using IPTW with asymptotic confidence intervals for cause 2</span></span></span>
<span class="r-in"><span><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu">adjustedcif</span><span class="op">(</span>data<span class="op">=</span><span class="va">sim_dat</span>,</span></span>
<span class="r-in"><span>                      variable<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                      ev_time<span class="op">=</span><span class="st">"time"</span>,</span></span>
<span class="r-in"><span>                      event<span class="op">=</span><span class="st">"event"</span>,</span></span>
<span class="r-in"><span>                      method<span class="op">=</span><span class="st">"iptw"</span>,</span></span>
<span class="r-in"><span>                      cause<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                      treatment_model<span class="op">=</span><span class="va">glm_mod</span>,</span></span>
<span class="r-in"><span>                      conf_int<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                      bootstrap<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using AIPTW with asymptotic confidence intervals for cause 1</span></span></span>
<span class="r-in"><span><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu">adjustedcif</span><span class="op">(</span>data<span class="op">=</span><span class="va">sim_dat</span>,</span></span>
<span class="r-in"><span>                      variable<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                      ev_time<span class="op">=</span><span class="st">"time"</span>,</span></span>
<span class="r-in"><span>                      event<span class="op">=</span><span class="st">"event"</span>,</span></span>
<span class="r-in"><span>                      cause<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                      method<span class="op">=</span><span class="st">"aiptw"</span>,</span></span>
<span class="r-in"><span>                      outcome_model<span class="op">=</span><span class="va">cox_mod</span>,</span></span>
<span class="r-in"><span>                      treatment_model<span class="op">=</span><span class="va">glm_mod</span>,</span></span>
<span class="r-in"><span>                      conf_int<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                      bootstrap<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using direct adjustment at custom points in time</span></span></span>
<span class="r-in"><span><span class="va">custom_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">1.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu">adjustedcif</span><span class="op">(</span>data<span class="op">=</span><span class="va">sim_dat</span>,</span></span>
<span class="r-in"><span>                      variable<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                      ev_time<span class="op">=</span><span class="st">"time"</span>,</span></span>
<span class="r-in"><span>                      event<span class="op">=</span><span class="st">"event"</span>,</span></span>
<span class="r-in"><span>                      cause<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                      method<span class="op">=</span><span class="st">"direct"</span>,</span></span>
<span class="r-in"><span>                      outcome_model<span class="op">=</span><span class="va">cox_mod</span>,</span></span>
<span class="r-in"><span>                      conf_int<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                      bootstrap<span class="op">=</span><span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                      times<span class="op">=</span><span class="va">custom_times</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using bootstrapping with direct adjustment</span></span></span>
<span class="r-in"><span><span class="co"># NOTE: In practice the number of bootstrap replications should be</span></span></span>
<span class="r-in"><span><span class="co">#       greater than 10. This is only shown here for convenience.</span></span></span>
<span class="r-in"><span><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu">adjustedcif</span><span class="op">(</span>data<span class="op">=</span><span class="va">sim_dat</span>,</span></span>
<span class="r-in"><span>                      variable<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                      ev_time<span class="op">=</span><span class="st">"time"</span>,</span></span>
<span class="r-in"><span>                      event<span class="op">=</span><span class="st">"event"</span>,</span></span>
<span class="r-in"><span>                      cause<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                      method<span class="op">=</span><span class="st">"direct"</span>,</span></span>
<span class="r-in"><span>                      outcome_model<span class="op">=</span><span class="va">cox_mod</span>,</span></span>
<span class="r-in"><span>                      conf_int<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                      bootstrap<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                      n_boot<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Loglik converged before variable  5 ; coefficient may be infinite. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Estimated risk outside the range [0,1].</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Consider setting the argument 'product.limit' to FALSE. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Loglik converged before variable  5 ; coefficient may be infinite. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Estimated risk outside the range [0,1].</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Consider setting the argument 'product.limit' to FALSE. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Estimated risk outside the range [0,1].</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Consider setting the argument 'product.limit' to FALSE. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Loglik converged before variable  5 ; coefficient may be infinite. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Estimated risk outside the range [0,1].</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Consider setting the argument 'product.limit' to FALSE. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Estimated risk outside the range [0,1].</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Consider setting the argument 'product.limit' to FALSE. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># not run because those are too slow</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># using bootstrapping with direct adjustment, run in parallel</span></span></span>
<span class="r-in"><span><span class="co"># on two cores</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">foreach</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://renozao.github.io/doRNG/" class="external-link">doRNG</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: rngtools</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu">adjustedcif</span><span class="op">(</span>data<span class="op">=</span><span class="va">sim_dat</span>,</span></span>
<span class="r-in"><span>                      variable<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                      ev_time<span class="op">=</span><span class="st">"time"</span>,</span></span>
<span class="r-in"><span>                      event<span class="op">=</span><span class="st">"event"</span>,</span></span>
<span class="r-in"><span>                      cause<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                      method<span class="op">=</span><span class="st">"direct"</span>,</span></span>
<span class="r-in"><span>                      outcome_model<span class="op">=</span><span class="va">cox_mod</span>,</span></span>
<span class="r-in"><span>                      conf_int<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                      bootstrap<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                      n_boot<span class="op">=</span><span class="fl">4</span>,</span></span>
<span class="r-in"><span>                      n_cores<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required namespace: doParallel</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Rare event </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using multiple imputation</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice" class="external-link">mice</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ngreifer.github.io/WeightIt/" class="external-link">WeightIt</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate some data as example</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_confounded_crisk.html">sim_confounded_crisk</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span>, max_t<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># introduce random missingness in x1 as example</span></span></span>
<span class="r-in"><span><span class="co"># NOTE: This is only done as an example, in reality you would</span></span></span>
<span class="r-in"><span><span class="co">#       already have missing data, not introduce it yourself.</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.5</span>, <span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span>, <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform multiple imputation</span></span></span>
<span class="r-in"><span><span class="va">mids</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">sim_dat</span>, method<span class="op">=</span><span class="st">"pmm"</span>, m<span class="op">=</span><span class="fl">2</span>, printFlag<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># IPTW Pseudo using WeightIt on imputed data, for cause = 1</span></span></span>
<span class="r-in"><span><span class="va">adj</span> <span class="op">&lt;-</span> <span class="fu">adjustedcif</span><span class="op">(</span>data<span class="op">=</span><span class="va">mids</span>,</span></span>
<span class="r-in"><span>                   variable<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                   ev_time<span class="op">=</span><span class="st">"time"</span>,</span></span>
<span class="r-in"><span>                   event<span class="op">=</span><span class="st">"event"</span>,</span></span>
<span class="r-in"><span>                   method<span class="op">=</span><span class="st">"iptw_pseudo"</span>,</span></span>
<span class="r-in"><span>                   cause<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                   treatment_model<span class="op">=</span><span class="va">group</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span>,</span></span>
<span class="r-in"><span>                   weight_method<span class="op">=</span><span class="st">"ps"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adj</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="adjustedcif-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># More specific examples can be found in the documentation of each</span></span></span>
<span class="r-in"><span><span class="co"># respective cif_method. See ?cif_ + "method" for more information.</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

