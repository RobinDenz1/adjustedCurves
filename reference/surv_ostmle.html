<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='

This page explains the details of estimating adjusted survival curves using the one-step targeted maximum likelihood methodology for single event time-to-event data (method="ostmle" in the adjustedsurv function). All regular arguments of the adjustedsurv function can be used. Additionally, the SL.ftime, SL.ctime and SL.trt arguments have to be specified in the adjustedsurv call. Further arguments specific to this method are listed below.'><title>One-Step Targeted Maximum Likelihood Estimation Survival Curves — surv_ostmle • adjustedCurves</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="One-Step Targeted Maximum Likelihood Estimation Survival Curves — surv_ostmle"><meta property="og:description" content='

This page explains the details of estimating adjusted survival curves using the one-step targeted maximum likelihood methodology for single event time-to-event data (method="ostmle" in the adjustedsurv function). All regular arguments of the adjustedsurv function can be used. Additionally, the SL.ftime, SL.ctime and SL.trt arguments have to be specified in the adjustedsurv call. Further arguments specific to this method are listed below.'><meta property="og:image" content="https://robindenz1.github.io/adjustedCurves/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">adjustedCurves</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">An Introduction to the 'adjustedCurves' Package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RobinDenz1/adjustedCurves/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>One-Step Targeted Maximum Likelihood Estimation Survival Curves</h1>
      
      <div class="d-none name"><code>surv_ostmle.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    

<p>This page explains the details of estimating adjusted survival curves using the one-step targeted maximum likelihood methodology for single event time-to-event data (<code>method="ostmle"</code> in the <code><a href="adjustedsurv.html">adjustedsurv</a></code> function). All regular arguments of the <code>adjustedsurv</code> function can be used. Additionally, the <code>SL.ftime</code>, <code>SL.ctime</code> and <code>SL.trt</code> arguments have to be specified in the <code>adjustedsurv</code> call. Further arguments specific to this method are listed below.</p>
    </div>


    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>adjust_vars</dt>
<dd><p>A character vector of column names specifying variables to be used when modeling the outcome, treatment and censoring mechanism. Can be set to <code>NULL</code> (default), in which case all covariates are used. See details and examples.</p></dd>

  <dt>SL.ftime</dt>
<dd><p>[<strong>required</strong>] A character vector or list specification to be passed to the <code>SL.library</code> option in the call to <code>SuperLearner</code> for the outcome regression. See<code>?SuperLearner</code> for more information on how to specify valid <code>SuperLearner</code> libraries. It is expected that the wrappers used in the library will play nicely with the input variables, which will be called "trt", <code>names(adjust_vars)</code>, and "t".</p></dd>

  <dt>SL.ctime</dt>
<dd><p>[<strong>required</strong>] A character vector or list specification to be passed to the <code>SL.library</code> argument in the call to <code>SuperLearner</code> for the estimate of the conditional hazard for censoring. It is expected that the wrappers used in the library will play nicely with the input variables, which will be called "trt" and <code>names(adjust_vars)</code>.</p></dd>

  <dt>SL.trt</dt>
<dd><p>[<strong>required</strong>] A character vector or list specification to be passed to the <code>SL.library</code> argument in the call to <code>SuperLearner</code> for the estimate of the conditional probability of treatment. It is expected that the wrappers used in the library will play nicely with the input variables, which will be <code>names(adjust_vars)</code>.</p></dd>

  <dt>epsilon</dt>
<dd><p>The size of the updating step. See <code>MOSS</code> for more details.</p></dd>

  <dt>max_num_iteration</dt>
<dd><p>The maximum number of iterations used in the updating step of the One-Step estimator.</p></dd>

  <dt>psi_moss_method</dt>
<dd><p>Specifies the method used to make the pooled updating step. Can be either <code>"l1"</code> (Ridge Regression), <code>"l2"</code> (LASSO) or <code>"glm"</code>. For more information see documentation of <code>MOSS</code>.</p></dd>

  <dt>tmle_tolerance</dt>
<dd><p>The tolerance used to determine whether the TMLE estimator converged or not. See <code>MOSS</code> for more details.</p></dd>

  <dt>gtol</dt>
<dd><p>Tolerance at which estimated treatment assignment probabilities are truncated. Every propensity score bigger than 1 - <code>gtol</code> is set to 1 - <code>gtol</code> and every propensity score smaller than <code>gtol</code> is set to <code>gtol</code>. Useful when there are extreme propensity scores close to 0 or 1.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    

<ul><li><p><strong>Type of Adjustment:</strong> Adjustments are made based on the treatment assignment mechanism, the outcome mechanism and the censoring mechanism. No models can be supplied. The adjustments are made based on <code><a href="https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html" class="external-link">SuperLearner</a></code> libraries.</p></li>
<li><p><strong>Doubly-Robust:</strong> Estimates are Doubly-Robust.</p></li>
<li><p><strong>Categorical groups:</strong> Currently only two groups in <code>variable</code> are allowed. Must be a factor variable with exactly two levels.</p></li>
<li><p><strong>Approximate Variance:</strong> Calculations to approximate the variance and confidence intervals are available.</p></li>
<li><p><strong>Allowed Time Values:</strong> Allows only integer time.</p></li>
<li><p><strong>Bounded Estimates:</strong> Estimates are guaranteed to be bounded in the 0 to 1 probability range.</p></li>
<li><p><strong>Monotone Function:</strong> Estimates are guaranteed to be monotone.</p></li>
<li><p><strong>Dependencies:</strong> This method relies on the <span class="pkg">survtmle</span>, <span class="pkg">MASS</span>, <span class="pkg">SuperLearner</span>, <span class="pkg">R6</span> and <span class="pkg">tidyr</span> packages. The code was taken directly from the <span class="pkg">MOSS</span> package, which is currently not available on CRAN. Tiny changes were made but it's essentially the same. You do not have to install it but it can be installed using the following code:<br><code>devtools::install_github("wilsoncai1992/MOSS")</code>. <br> If you use this method, please cite the <span class="pkg">MOSS</span> package.</p></li>
</ul><p>Standard TMLE is a two-step procedure. First, initial estimates for the treatment-assignment and the outcome-mechanisms are made using loss-based learning. This is implemented here using the <code>SuperLearner</code> methodology. In the next step, the estimates obtained by using the outcome-mechanism model are fluctuated based on information from the treatment-assignment model. If the outcome model is already consistent, this fluctuation is very small and the estimates stay consistent. If the outcome model is biased, the fluctuation removes the bias whenever the treatment assignment model is consistent. This process is iterative and continues until a threshold is hit (either the maximum number of iterations is reached or the bias is smaller than the specified tolerance, see <code><a href="https://rdrr.io/pkg/survtmle/man/survtmle.html" class="external-link">?survtmle</a></code>).</p>
<p>In contrast to the estimator implemented in the <code><a href="surv_tmle.html">tmle</a></code> method, the OSTMLE uses a LASSO or Ridge Regression model in the targeting step to fluctuate the initial estimates. Details can be found in Cai and van der Laan (2020).</p>
<p>As has been shown in multiple studies by Mark J. van der Laan and colleagues, this method has some desirable mathematical properties and generally performs well in appropriate scenarios. The biggest problem is however, that it is only defined for discrete (integer-valued) survival times. Simply discretizing continuous survival times only works to a certain extent and is generally discouraged.</p>
<p>When the sample size is large or many time points are of interest, this method will also be *very* slow. While possible to run, bootstrapping would take an enormous amount of time and is therefore discouraged.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    


<p>Adds the following additional objects to the output of the <code>adjustedsurv</code> function:</p>


<ul><li><p><code>psi_moss_hazard_0</code>: The iterated MOSS objects for the control group.</p></li>
<li><p><code>psi_moss_hazard_1</code>: The iterated MOSS objects for the treatment group.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Weixin Cai and Mark J. van der Laan (2020). "One-Step Targeted Maximum Likelihood Estimation for Time-To-Event Outcomes". In: Biometrics 76, pp. 722–733</p>
<p>David Benkeser, Marco Carone, and Peter B. Gilbert (2018). "Improved Estimation of the Cumulative Incidence of Rare Outcomes". In: Statistics in Medicine 37.2, pp. 280–293</p>
<p>Megan S. Schuler and Sherri Rose (2017). "Targeted Maximum Likelihood Estimation for Causal Inference in Observational Studies". In: American Journal of Epidemiology 186.1, pp. 65-73</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>The wrapper function was written by Robin Denz, the <code>MOSS</code> package (which this wrapper is based on) was written by Wilson Cai. See &lt;https://github.com/wilsoncai1992/MOSS/&gt; for more details.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/survtmle/man/survtmle.html" class="external-link">survtmle</a></code>, <code>MOSS</code>, <code><a href="https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html" class="external-link">SuperLearner</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># not run because any meaningful example is too slow</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/adjustedCurves" class="external-link">adjustedCurves</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate some data as example</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_confounded_surv.html">sim_confounded_surv</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span>, max_t<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># only works with integer time, only unbiased with small amounts of them</span></span></span>
<span class="r-in"><span><span class="va">sim_dat</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">time</span><span class="op">*</span><span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate adjusted survival curves, using SuperLearner but only</span></span></span>
<span class="r-in"><span><span class="co"># using the SL.glm library. In practice you would want to use more than</span></span></span>
<span class="r-in"><span><span class="co"># that. See ?MOSS and ?survtmle</span></span></span>
<span class="r-in"><span><span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">sim_dat</span>,</span></span>
<span class="r-in"><span>                        variable<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                        ev_time<span class="op">=</span><span class="st">"time"</span>,</span></span>
<span class="r-in"><span>                        event<span class="op">=</span><span class="st">"event"</span>,</span></span>
<span class="r-in"><span>                        method<span class="op">=</span><span class="st">"ostmle"</span>,</span></span>
<span class="r-in"><span>                        adjust_vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"x4"</span>, <span class="st">"x5"</span>, <span class="st">"x6"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        SL.ftime<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.glm"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        SL.ctim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.glm"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        SL.trt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.glm"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> censoring sl error</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Max number of iteration reached, stop TMLE</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Max number of iteration reached, stop TMLE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the curves</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="surv_ostmle-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

