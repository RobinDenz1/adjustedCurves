<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="adjustedCurves">
<title>An Introduction to the 'adjustedCurves' Package • adjustedCurves</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An Introduction to the 'adjustedCurves' Package">
<meta property="og:description" content="adjustedCurves">
<meta property="og:image" content="https://robindenz1.github.io/adjustedCurves/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">adjustedCurves</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">An Introduction to the 'adjustedCurves' Package</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RobinDenz1/adjustedCurves/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>An Introduction to the 'adjustedCurves' Package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RobinDenz1/adjustedCurves/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<p>The main purpose of the <code>adjustedCurves</code> R-Package is to calculate and plot confounder-adjusted survival curves and cause-specific confounder-adjusted cumulative incidence functions (CIF) using a variety of methods. Group- or treatment-specific survival curves and cumulative incidence functions are often used to graphically display the treatment (or group) effect on the survival probability. When the data at hand comes from a randomized controlled trial with balanced subgroups, simple stratified estimators of the survival curves or CIFs are unbiased. When randomization fails or was not done at all however, confounding can lead to biased depictions (see Rubin 1974; Pearl 2009).</p>
<p>Luckily, a lot of different methods to adjust survival curves and CIFs for confounding have been proposed. With the <code>adjustedCurves</code> package, these methods can be used with little effort.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The R-Package is currently not available on CRAN, but can be installed easily using the <code>devtools</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"RobinDenz1/adjustedCurves"</span><span class="op">)</span></code></pre></div>
<p>or the <code>remotes</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"RobinDenz1/adjustedCurves"</span><span class="op">)</span></code></pre></div>
<p>Further packages might have to be installed, depending on the specified method.</p>
</div>
<div class="section level2">
<h2 id="adjusted-survival-curves">Adjusted Survival Curves<a class="anchor" aria-label="anchor" href="#adjusted-survival-curves"></a>
</h2>
<p>Let’s start with the standard survival setting. Using the <code>sim_confounded_surv</code> function, we simulate some survival data (Chatton et al. 2020):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/adjustedCurves" class="external-link">adjustedCurves</a></span><span class="op">)</span>

<span class="co"># set random number generator seed to make this reproducible</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">41</span><span class="op">)</span>

<span class="co"># simulate standard survival data with 300 rows</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_confounded_surv.html">sim_confounded_surv</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">300</span>, max_t<span class="op">=</span><span class="fl">1.1</span>, group_beta<span class="op">=</span><span class="op">-</span><span class="fl">0.6</span><span class="op">)</span>
<span class="co"># code the grouping variable as a factor</span>
<span class="va">data</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>

<span class="co"># take a look at the first few rows</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   x1 x2 x3         x4         x5         x6 group      time event</span>
<span class="co">## 1  0  1  1  0.3009753 -0.8457787 -1.0629242     0 0.5877590     1</span>
<span class="co">## 2  1  1  1 -0.4246957  1.2526557 -0.9759365     0 0.2620015     1</span>
<span class="co">## 3  1  0  1  1.2758093 -0.6487439  0.4174419     1 0.7096176     1</span>
<span class="co">## 4  0  0  0 -0.3353432 -0.3888960 -1.3187617     0 0.6344717     1</span>
<span class="co">## 5  1  1  0  1.1226585 -2.0605362 -2.2049385     0 0.6684994     1</span>
<span class="co">## 6  1  1  1 -1.1457605 -0.6020554 -0.9689735     0 0.4787611     1</span></code></pre>
<p>Using the default arguments, this function outputs a data.frame with 6 independently drawn covariates (<code>x1</code> - <code>x6</code>), a binary group variable (<code>group</code>), the observed event time (<code>time</code>) and the event indicator (<code>event</code>). In this setting, there is only one type of event (<code>1</code>). When the observations are right-censored this indicator is set to <code>0</code>. This is the standard data format used in standard time-to-event analysis.</p>
<div class="section level3">
<h3 id="direct-standardization">Direct Standardization<a class="anchor" aria-label="anchor" href="#direct-standardization"></a>
</h3>
<p>To calculate confounder-adjusted survival curves fo each group of this dataset using <em>Direct Standardization</em> (also known as <em>G-Computation</em> or <em>Corrected Group Prognosis method</em>, see Makuch (1982) or Chang et al. (1982)), we first have to fit a <code>coxph</code> model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># it is important to use X=TRUE in the coxph function call</span>
<span class="va">outcome_model</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> 
                                   <span class="va">x6</span> <span class="op">+</span> <span class="va">group</span>,
                                 data<span class="op">=</span><span class="va">data</span>, x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>This model can then be used in a call to the <code>adjustedsurv</code> function, as shown below:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,
                        variable<span class="op">=</span><span class="st">"group"</span>,
                        ev_time<span class="op">=</span><span class="st">"time"</span>,
                        event<span class="op">=</span><span class="st">"event"</span>,
                        method<span class="op">=</span><span class="st">"direct"</span>,
                        outcome_model<span class="op">=</span><span class="va">outcome_model</span>,
                        conf_int<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>The argument <code>data</code> simply refers to our data.frame, the argument <code>variable</code> specifies our grouping variable of interest and the <code>ev_time</code> and <code>event</code> variable specify the time-to-event variables in our data.frame. Setting the <code>method</code> to <code>"direct"</code> will result in G-Computation estimates, based on the previously fit cox-regression model supplied using the <code>outcome_model</code> argument.</p>
<p>Doing this returns a list with some needed output objects. Most important however is the <code>adjsurv</code> data.frame in there, containing the adjusted survival curves and corresponding confidence intervals (because we used <code>conf_int=TRUE</code> in the original function call). We can take a look at this object using the following code:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">adjsurv</span><span class="op">$</span><span class="va">adjsurv</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##         time      surv group          se  ci_lower  ci_upper</span>
<span class="co">## 1 0.00000000 1.0000000     0 0.000000000 1.0000000 1.0000000</span>
<span class="co">## 2 0.02658129 0.9958662     0 0.004145877 0.9877404 1.0000000</span>
<span class="co">## 3 0.05820661 0.9916462     0 0.005931559 0.9800206 1.0000000</span>
<span class="co">## 4 0.06479831 0.9873682     0 0.007302477 0.9730557 1.0000000</span>
<span class="co">## 5 0.07258965 0.9830982     0 0.008416298 0.9666025 0.9995938</span>
<span class="co">## 6 0.07803725 0.9788482     0 0.009439635 0.9603469 0.9973496</span></code></pre>
<p>More importantly however, we can plot the survival curves directly using the <code>plot</code> method:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-7-1.png" width="672"> This plot function comes with many options which are listed in the documentation. To plot the point-wise confidence intervals, we can set the argument <code>conf_int</code> to TRUE:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Loading required namespace: pammtools</span></code></pre>
<p><img src="introduction_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Instead of using colors to differentiate the curves we can also use different linetypes, by setting the <code>linetype</code> argument to TRUE and the <code>color</code> argument to <code>FALSE</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span>, linetype<span class="op">=</span><span class="cn">TRUE</span>, color<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>We can also add small indicator lines for censored observations using <code>censoring_ind="lines"</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span>, color<span class="op">=</span><span class="cn">TRUE</span>, censoring_ind<span class="op">=</span><span class="st">"lines"</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Indicator lines for the median survival time can be added using <code>median_surv_lines=TRUE</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span>, color<span class="op">=</span><span class="cn">TRUE</span>, median_surv_lines<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>Many more custom settings are available. For more details and examples see <code><a href="../reference/plot.adjustedsurv.html">?plot.adjustedsurv</a></code>.</p>
</div>
<div class="section level3">
<h3 id="inverse-probability-of-treatment-weighting">Inverse Probability of Treatment Weighting<a class="anchor" aria-label="anchor" href="#inverse-probability-of-treatment-weighting"></a>
</h3>
<p>The <code>adjustedsurv</code> function essentially works the same with every available method. Since the methods are however vastly different in nature, some additional arguments have to be supplied by the user. For example, using the Inverse Probability of Treatment Weighting method (IPTW), we need to model the <em>treatment assignment mechanism</em> instead of the outcome mechanism (see Xie and Liu (2005)). This can be done using a logistic regression model as follows:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">treatment_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span>,
                       data<span class="op">=</span><span class="va">data</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span>

<span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,
                        variable<span class="op">=</span><span class="st">"group"</span>,
                        ev_time<span class="op">=</span><span class="st">"time"</span>,
                        event<span class="op">=</span><span class="st">"event"</span>,
                        method<span class="op">=</span><span class="st">"iptw_km"</span>,
                        treatment_model<span class="op">=</span><span class="va">treatment_model</span>,
                        conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The resulting curves can be plotted as before:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>Since both methods were used correctly here, there are only slight differences in the results. Big differences between the two methods usually indicate that either the cox-regression model or the logistic regression model are incorrectly specified.</p>
</div>
<div class="section level3">
<h3 id="augmented-inverse-probability-of-treatment-weighting">Augmented Inverse Probability of Treatment Weighting<a class="anchor" aria-label="anchor" href="#augmented-inverse-probability-of-treatment-weighting"></a>
</h3>
<p>Doubly-Robust methods can be helpful in such cases (see Robins and Rotnitzky (1992) or Ozenne et al. (2020)). The standard Augmented Inverse Probability of Treatment Weighting estimator utilized both kinds of models at the same time. If either of the models is correctly specified, the resulting estimates will be unbiased. It can be used in the same way as the other methods, only that this time both models have to be supplied:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">treatment_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span>,
                       data<span class="op">=</span><span class="va">data</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span>

<span class="va">outcome_model</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> 
                                   <span class="va">x6</span> <span class="op">+</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">data</span>, x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,
                        variable<span class="op">=</span><span class="st">"group"</span>,
                        ev_time<span class="op">=</span><span class="st">"time"</span>,
                        event<span class="op">=</span><span class="st">"event"</span>,
                        method<span class="op">=</span><span class="st">"aiptw"</span>,
                        treatment_model<span class="op">=</span><span class="va">treatment_model</span>,
                        outcome_model<span class="op">=</span><span class="va">outcome_model</span>,
                        conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="adjusted-cumulative-incidence-functions">Adjusted Cumulative Incidence Functions<a class="anchor" aria-label="anchor" href="#adjusted-cumulative-incidence-functions"></a>
</h2>
<p>In many situations there are multiple mutually exclusive types of events instead of just one event. This is formally known as a competing risks situation. In these situations, survival curves can not be estimated anymore. However, the cumulative incidence function can be used instead. Without randomization, these CIFs face the same problems due to confounding as the survival curves do. Many of the methods to adjust survival curves for confounders can be used to adjust CIFs in very similar fashion.</p>
<p>While the computational details and the underlying theory is slightly different (see Ozenne et al. (2020)), the syntax for the R-Package stays pretty much exactly the same. The only major difference is that instead of using the <code>adjustedsurv</code> function, the <code>adjustedcif</code> function should be utilized. Additionally, the user now also has to specify which event-type is of interest (argument <code>cause</code>).</p>
<p>First we need new example data, mirroring the competing risks situation. We are going to use the <code>sim_confounded_crisk</code> function, which does the same thing as the <code>sim_confounded_surv</code> function, but with competing risks data:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_confounded_crisk.html">sim_confounded_crisk</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">300</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="direct-standardization-1">Direct Standardization<a class="anchor" aria-label="anchor" href="#direct-standardization-1"></a>
</h3>
<p>Let’s again start with the <em>Direct Standardization</em> method. Instead of using a simple <code>coxph</code> method, we need to use a model for the time-to-event process which takes the multiple event-types into account. One such method is the <em>Cause-Specific Cox-Regression</em> model. A simple implementation of this model is contained in the <code>riskRegression</code> R-Package.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outcome_model</span> <span class="op">&lt;-</span> <span class="fu">riskRegression</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/riskRegression/man/CSC.html" class="external-link">CSC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/Hist.html" class="external-link">Hist</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> 
                                       <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span> <span class="op">+</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<p>This model can then be used in a call to the <code>adjustedcif</code> function, as shown below:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedcif.html">adjustedcif</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,
                      variable<span class="op">=</span><span class="st">"group"</span>,
                      ev_time<span class="op">=</span><span class="st">"time"</span>,
                      event<span class="op">=</span><span class="st">"event"</span>,
                      method<span class="op">=</span><span class="st">"direct"</span>,
                      outcome_model<span class="op">=</span><span class="va">outcome_model</span>,
                      cause<span class="op">=</span><span class="fl">1</span>,
                      conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjcif</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>This shows the confounder-adjusted cumulative incidence functions for cause = 1. By setting cause to 2 we get the confounder-adjusted cumulative incidence functions for the other cause:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedcif.html">adjustedcif</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,
                      variable<span class="op">=</span><span class="st">"group"</span>,
                      ev_time<span class="op">=</span><span class="st">"time"</span>,
                      event<span class="op">=</span><span class="st">"event"</span>,
                      method<span class="op">=</span><span class="st">"direct"</span>,
                      outcome_model<span class="op">=</span><span class="va">outcome_model</span>,
                      cause<span class="op">=</span><span class="fl">2</span>,
                      conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjcif</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="inverse-probability-of-treatment-weighting-1">Inverse Probability of Treatment Weighting<a class="anchor" aria-label="anchor" href="#inverse-probability-of-treatment-weighting-1"></a>
</h3>
<p>The IPTW estimator can be used exactly the same way as we did with the <code>adjustedsurv</code> function:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">treatment_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span>,
                       data<span class="op">=</span><span class="va">data</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span>

<span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedcif.html">adjustedcif</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,
                      variable<span class="op">=</span><span class="st">"group"</span>,
                      ev_time<span class="op">=</span><span class="st">"time"</span>,
                      event<span class="op">=</span><span class="st">"event"</span>,
                      method<span class="op">=</span><span class="st">"iptw"</span>,
                      treatment_model<span class="op">=</span><span class="va">treatment_model</span>,
                      cause<span class="op">=</span><span class="fl">1</span>,
                      conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjcif</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<p>The other estimators can be used using essentially the same syntax.</p>
</div>
</div>
<div class="section level2">
<h2 id="adjusted-curves-with-more-than-two-treatments">Adjusted Curves with more than two treatments<a class="anchor" aria-label="anchor" href="#adjusted-curves-with-more-than-two-treatments"></a>
</h2>
<p>In many applications there are more than two treatments. Some of the methods included in this R-Package allow calculations for an arbitrary number of treatments. In these cases the code does not change at all and can be used exactly in the same way as before. The only difference occurs when using IPTW methods. Here the user has to use a multinomial logistic regression model instead of a regular logistic regression to model the outcome. This is illustrated below.</p>
<p>First we again create a simulated data set (for single event survival data). The function is only able to create binary treatment variables, but we can simply resample all occurrences of 1 into 1 and 2, creating 3 treatments, where 1 and 2 have an identical treatment effect and selection process:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set random number generator seed to make this reproducible</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">41</span><span class="op">)</span>

<span class="co"># simulate standard survival data with 300 rows</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_confounded_surv.html">sim_confounded_surv</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">300</span><span class="op">)</span>

<span class="co"># add another group (NOTE: this is done only to showcase the method and does not</span>
<span class="co"># reflect what should be done in real situations)</span>
<span class="va">data</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,
                                          replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># code the grouping variable as a factor</span>
<span class="va">data</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></code></pre></div>
<p>The Direct Adjusted survival curves can be calculated exactly as before:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outcome_model</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> 
                                   <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span> <span class="op">+</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">data</span>, x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,
                        variable<span class="op">=</span><span class="st">"group"</span>,
                        ev_time<span class="op">=</span><span class="st">"time"</span>,
                        event<span class="op">=</span><span class="st">"event"</span>,
                        method<span class="op">=</span><span class="st">"direct"</span>,
                        outcome_model<span class="op">=</span><span class="va">outcome_model</span>,
                        conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<p>For the IPTW based estimates we first fit a multinomial logistic regression model using the <code>multinom</code> function from the <code>nnet</code> R-Package and use it with the same code as before:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">treatment_model</span> <span class="op">&lt;-</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span>,
                                  data<span class="op">=</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## # weights:  24 (14 variable)</span>
<span class="co">## initial  value 329.583687 </span>
<span class="co">## iter  10 value 297.006395</span>
<span class="co">## iter  20 value 296.077106</span>
<span class="co">## final  value 296.077099 </span>
<span class="co">## converged</span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,
                        variable<span class="op">=</span><span class="st">"group"</span>,
                        ev_time<span class="op">=</span><span class="st">"time"</span>,
                        event<span class="op">=</span><span class="st">"event"</span>,
                        method<span class="op">=</span><span class="st">"iptw_km"</span>,
                        treatment_model<span class="op">=</span><span class="va">treatment_model</span>,
                        conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="calculating-the-adjusted-restricted-mean-survival-time">Calculating the adjusted restricted mean survival time<a class="anchor" aria-label="anchor" href="#calculating-the-adjusted-restricted-mean-survival-time"></a>
</h2>
<p>An alternative measure to hazard-ratios is the restricted mean survival time, which denotes the integral of the survival curve from time 0 up to a specified point in time (see Royston et al. 2013). A confounder adjusted version of this statistic can be calculated by simply integrating the confounder adjusted survival curves instead of a normal Kaplan-Meier curve (Conner et al. 2019). The <code>adjustedCurves</code> package allows the user to do this by simply calling the <code>adjusted_rmst</code> function on a previously created <code>adjustedsurv</code> object:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/adjusted_rmst.html">adjusted_rmst</a></span><span class="op">(</span><span class="va">adjsurv</span>, to<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## ------------------------------------------------------------------</span>
<span class="co">##        Confounder-Adjusted Restricted Mean Survival Time</span>
<span class="co">## ------------------------------------------------------------------</span>
<span class="co">## </span>
<span class="co">## Using the interval: 0 to 1 </span>
<span class="co">## </span>
<span class="co">##      RMST</span>
<span class="co">## 0 0.49882</span>
<span class="co">## 1 0.59543</span>
<span class="co">## 2 0.64151</span>
<span class="co">## ------------------------------------------------------------------</span></code></pre>
<p>The function returns adjusted RMST for every level of the “group” variable. When bootstrapping was performed when calling the <code>adjustedsurv</code> function, standard deviations and confidence intervals can be calculated using this function as well by setting the <code>use_boot</code> argument to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,
                        variable<span class="op">=</span><span class="st">"group"</span>,
                        ev_time<span class="op">=</span><span class="st">"time"</span>,
                        event<span class="op">=</span><span class="st">"event"</span>,
                        method<span class="op">=</span><span class="st">"iptw_km"</span>,
                        treatment_model<span class="op">=</span><span class="va">treatment_model</span>,
                        conf_int<span class="op">=</span><span class="cn">TRUE</span>,
                        bootstrap<span class="op">=</span><span class="cn">TRUE</span>,
                        n_boot<span class="op">=</span><span class="fl">300</span><span class="op">)</span>

<span class="va">adjrmst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjusted_rmst.html">adjusted_rmst</a></span><span class="op">(</span><span class="va">adjsurv</span>, to<span class="op">=</span><span class="fl">1</span>, use_boot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">adjrmst</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## ------------------------------------------------------------------</span>
<span class="co">##        Confounder-Adjusted Restricted Mean Survival Time</span>
<span class="co">## ------------------------------------------------------------------</span>
<span class="co">## </span>
<span class="co">## Using the interval: 0 to 1 </span>
<span class="co">## </span>
<span class="co">##      RMST RMST SE 95% CI (lower) 95% CI (upper) N Boot</span>
<span class="co">## 0 0.49882 0.02294        0.46291        0.53987    300</span>
<span class="co">## 1 0.59543 0.03757        0.53342        0.66128    300</span>
<span class="co">## 2 0.64151 0.03736        0.58050        0.70010    300</span>
<span class="co">## ------------------------------------------------------------------</span></code></pre>
<p>The results can also be plotted easily:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjrmst</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="testing-the-difference-betweeen-two-survival-curves">Testing the Difference betweeen Two Survival Curves<a class="anchor" aria-label="anchor" href="#testing-the-difference-betweeen-two-survival-curves"></a>
</h2>
<p>In some cases the researcher might be interested to formally test the hypothesis that two adjusted survival curves or two cumulative incidence functions are different in a certain interval. This can be done with the <code>adjusted_curve_diff</code> function. It calculates the integral of the difference between two curves for each bootstrap estimate, shifts that distribution to be centered around 0 and calculates a p-value based on that shifted distribution:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set random number generator seed to make this reproducible</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">41</span><span class="op">)</span>

<span class="co"># simulate standard survival data with 300 rows</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_confounded_surv.html">sim_confounded_surv</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">300</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>

<span class="co"># fit cox-regression model</span>
<span class="va">outcome_model</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> 
                                   <span class="va">x6</span> <span class="op">+</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">data</span>, x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># run adjustedsurv with bootstrap=TRUE</span>
<span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>,
                        variable<span class="op">=</span><span class="st">"group"</span>,
                        ev_time<span class="op">=</span><span class="st">"time"</span>,
                        event<span class="op">=</span><span class="st">"event"</span>,
                        method<span class="op">=</span><span class="st">"direct"</span>,
                        outcome_model<span class="op">=</span><span class="va">outcome_model</span>,
                        bootstrap<span class="op">=</span><span class="cn">TRUE</span>,
                        n_boot<span class="op">=</span><span class="fl">300</span><span class="op">)</span>

<span class="co"># test equality</span>
<span class="va">adjtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjusted_curve_diff.html">adjusted_curve_diff</a></span><span class="op">(</span><span class="va">adjsurv</span>, from<span class="op">=</span><span class="fl">0</span>, to<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">adjtest</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## ------------------------------------------------------------------</span>
<span class="co">##    Test of the Difference between two adjusted Survival Curves</span>
<span class="co">## ------------------------------------------------------------------</span>
<span class="co">## </span>
<span class="co">## Using the interval: 0 to 1 </span>
<span class="co">## </span>
<span class="co">##           ABC ABC SE 95% CI (lower) 95% CI (upper) P-Value N Boot</span>
<span class="co">## 0 vs. 1 0.161 0.0266         0.1058         0.2116       0    300</span>
<span class="co">## ------------------------------------------------------------------</span></code></pre>
<p>This function also offers two diagnostic plots, which can be used to graphically check the result of the test. The first simply plots all the curves of the differences in grey, with the actually observed estimate in black:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjtest</span>, type<span class="op">=</span><span class="st">"curves"</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
<p>The grey curves should scatter randomly around the black curve, with the black curve in the middle, just like in the example above. If this is not the case or there are multiple grey curves with an unusually large distance to the black curve, the results of this test might be wrong.</p>
<p>The second graphic shows a kernel-density estimate of the shifted bootstrap distribution of the integrals of the difference. The red line is the actually observed integral in the plot. The further away the red line is from the center of the distribution, the less likely it is that this value was observed by chance alone.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjtest</span>, type<span class="op">=</span><span class="st">"integral"</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-28-1.png" width="672"></p>
<p>Similarly to the first plot, the kernel density estimate should be approximately normally distributed with 0 at the center, just like in the example above. If the distribution is very skewed, the test results might be wrong.</p>
<p>The <code>adjusted_curve_diff</code> function can also be used with more than two groups. In that case it returns pairwise comparisons.</p>
</div>
<div class="section level2">
<h2 id="literature">Literature<a class="anchor" aria-label="anchor" href="#literature"></a>
</h2>
<p>Donald B. Rubin (1974). “Estimating Causal Effects of Treatments in Randomized and Nonrandomized Studies”. In: Journal of Educational Psychology 66.5, pp. 688-701</p>
<p>Judea Pearl (2009). Causality: Models, Reasoning and Inference. 2nd ed. Cambridge: Cambridge University Press</p>
<p>Arthur Chatton, Florent Le Borgne, Clemence Leyrat, and Yohann Foucher (2020). G-Computation and Inverse Probability Weighting for Time-To-Event Outcomes: A Comparative Study. arXiv:2006.16859v1</p>
<p>Robert W. Makuch (1982). “Adjusted Survival Curve Estimation Using Covariates”. In: Journal of Chronic Diseases 35.6, pp. 437-443</p>
<p>I-Ming Chang, Rebecca Gelman, and Marcello Pagano (1982). “Corrected Group Prognostic Curves and Summary Statistics”. In: Journal of Chronic Diseases 35, pp. 669-674</p>
<p>Jun Xie and Chaofeng Liu (2005). “Adjusted Kaplan-Meier Estimator and Log-Rank Test with Inverse Probability of Treatment Weighting for Survival Data”. In: Statistics in Medicine 24, pp. 3089-3110</p>
<p>James M. Robins and Andrea Rotnitzky (1992). “Recovery of Information and Adjustment for Dependent Censoring Using Surrogate Markers”. In: AIDS Epidemiology: Methodological Issues. Ed. by Nicholas P. Jewell, Klaus Dietz, and Vernon T. Farewell. New York: Springer Science + Business Media, pp. 297-331</p>
<p>Brice Maxime Hugues Ozenne, Thomas Harder Scheike, and Laila Staerk (2020). “On the Estimation of Average Treatment Effects with Right-Censored Time to Event Outcome and Competing Risks”. In: Biometrical Journal 62, pp. 751-763</p>
<p>Weixin Cai and Mark J. van der Laan (2020). “One-Step Targeted Maximum Likelihood Estimation for Time-To-Event Outcomes”. In: Biometrics 76, pp. 722-733</p>
<p>Patrick Royston and Mahesh K. B. Parmar (2013). “Restricted Mean Survival Time: An Alternative to the Hazard Ratio for the Design and Analysis of Randomized Trials with a Time-To-Event Outcome”. In: BMC Medical Research Methodology 13.152</p>
<p>Sarah C. Conner, Lisa M. Sullivan, Emelia J. Benjamin, Michael P. LaValley, Sandro Galea, and Ludovic Trinquart (2019). “Adjusted Restricted Mean Survival Times in Observational Studies”. In: Statistics in Medicine 38, pp. 3832-3860</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
