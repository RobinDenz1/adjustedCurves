<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An Introduction to the 'adjustedCurves' Package • adjustedCurves</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An Introduction to the 'adjustedCurves' Package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">adjustedCurves</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.11.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">An Introduction to the 'adjustedCurves' Package</a></li>
    <li><a class="dropdown-item" href="../articles/method_overview.html">Overview of methods in adjustedCurves</a></li>
    <li><a class="dropdown-item" href="../articles/plot_customization.html">Customizing Adjusted Survival Curve Plots</a></li>
    <li><a class="dropdown-item" href="../articles/comparing_groups.html">Comparing Adjusted Survival Curves or Cumulative Incidence Curves</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">Frequently Asked Questions about the adjustedCurves Package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/adjustedCurves/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>An Introduction to the 'adjustedCurves' Package</h1>
                        <h4 data-toc-skip class="author">Robin Denz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RobinDenz1/adjustedCurves/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<p>The main purpose of the <code>adjustedCurves</code> R-Package is to
estimate and plot confounder-adjusted survival curves and cause-specific
confounder-adjusted cumulative incidence functions (CIF) using a variety
of methods. Group- or treatment-specific survival curves and CIFs are
often used to graphically display the treatment (or group) effect on the
survival probability. When the data at hand comes from a randomized
controlled trial with balanced subgroups, simple stratified estimators
of the survival curves or CIFs ignoring other covariates are unbiased.
When randomization fails or was not done at all however, confounding can
lead to biased depictions (see Pearl 2009).</p>
<p>Luckily, a lot of different methods to adjust survival curves and
CIFs for confounding have been proposed. With the
<code>adjustedCurves</code> package, these methods can be used with
little effort. A review and simulation study comparing these methods can
be found in Denz et al. (2023).</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>A stable version of this package can be installed directly from
CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"adjustedCurves"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, the developmental version can be installed from github
using the <code>remotes</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"RobinDenz1/adjustedCurves"</span><span class="op">)</span></span></code></pre></div>
<p>Further packages might have to be installed, depending on the
specified method.</p>
</div>
<div class="section level2">
<h2 id="adjusted-survival-curves">Adjusted Survival Curves<a class="anchor" aria-label="anchor" href="#adjusted-survival-curves"></a>
</h2>
<p>Let’s start with the standard survival setting. Using the
<code>sim_confounded_surv</code> function, we simulate some survival
data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tagteam/riskRegression" class="external-link">riskRegression</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://adibender.github.io/pammtools/" class="external-link">pammtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/adjustedCurves" class="external-link">adjustedCurves</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set random number generator seed to make this reproducible</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">44</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate standard survival data with 300 rows</span></span>
<span><span class="va">data_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_confounded_surv.html">sim_confounded_surv</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">300</span>, max_t<span class="op">=</span><span class="fl">1.1</span>, group_beta<span class="op">=</span><span class="op">-</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co"># code the grouping variable as a factor</span></span>
<span><span class="va">data_1</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data_1</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># take a look at the first few rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   x1 x2 x3          x4          x5          x6 group       time event</span></span>
<span><span class="co">## 1  1  0  0 -0.52520986  0.22776621 -0.05319665     1 0.37181297     1</span></span>
<span><span class="co">## 2  0  1  1  0.02441988 -2.16818274  0.58097459     0 0.65649863     1</span></span>
<span><span class="co">## 3  1  1  1  0.05159071  0.07329185  1.18737651     1 0.08156474     0</span></span>
<span><span class="co">## 4  1  0  0  0.01956631 -1.27205270  1.16594437     0 0.34161603     1</span></span>
<span><span class="co">## 5  0  1  0  0.33793112  1.32447922 -1.28991227     0 0.52472847     1</span></span>
<span><span class="co">## 6  0  1  0 -2.96505672  2.19434272  0.00528396     1 0.87274894     1</span></span></code></pre>
<p>Using the default arguments, this function outputs a data.frame with
6 independently drawn covariates (<code>x1</code> - <code>x6</code>), a
binary group variable (<code>group</code>), the observed event time
(<code>time</code>) and the event indicator (<code>event</code>). In
this setting, there is only one type of event (<code>1</code>). When the
observations are right-censored this indicator is set to <code>0</code>.
This is the standard data format used in standard time-to-event
analysis.</p>
<div class="section level3">
<h3 id="direct-standardization">Direct Standardization<a class="anchor" aria-label="anchor" href="#direct-standardization"></a>
</h3>
<p>To calculate confounder-adjusted survival curves fo each group of
this dataset using <em>Direct Standardization</em> (also known as
<em>G-Computation</em> or <em>Corrected Group Prognosis method</em>, see
Makuch (1982) or Chang et al. (1982)), we first have to fit a model.
Here we will use a <code>coxph</code> model, but we could also use
pretty much any other kind of model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># it is important to use X=TRUE in the coxph function call</span></span>
<span><span class="va">outcome_model</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> </span>
<span>                                   <span class="va">x6</span> <span class="op">+</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">data_1</span>, x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This model can then be used in a call to the
<code><a href="../reference/adjustedsurv.html">adjustedsurv()</a></code> function, as shown below:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data_1</span>,</span>
<span>                        variable<span class="op">=</span><span class="st">"group"</span>,</span>
<span>                        ev_time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                        event<span class="op">=</span><span class="st">"event"</span>,</span>
<span>                        method<span class="op">=</span><span class="st">"direct"</span>,</span>
<span>                        outcome_model<span class="op">=</span><span class="va">outcome_model</span>,</span>
<span>                        conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The argument <code>data</code> simply refers to our data.frame, the
argument <code>variable</code> specifies our grouping variable of
interest and the <code>ev_time</code> and <code>event</code> variable
specify the time-to-event variables in our data.frame. Setting the
<code>method</code> to <code>"direct"</code> will result in
G-Computation estimates, based on the previously fit cox-regression
model supplied using the <code>outcome_model</code> argument.</p>
<p>Doing this returns a list with some needed output objects. Most
important however is the <code>adj</code> data.frame in there,
containing the adjusted survival curves and corresponding confidence
intervals (because we used <code>conf_int=TRUE</code> in the original
function call). We can take a look at this object using the following
code:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">adjsurv</span><span class="op">$</span><span class="va">adj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         time      surv group          se  ci_lower  ci_upper</span></span>
<span><span class="co">## 1 0.00000000 1.0000000     0 0.000000000 1.0000000 1.0000000</span></span>
<span><span class="co">## 2 0.01457659 0.9959356     0 0.004039858 0.9880177 1.0000000</span></span>
<span><span class="co">## 3 0.04062032 0.9917639     0 0.005767859 0.9804591 1.0000000</span></span>
<span><span class="co">## 4 0.04232678 0.9876128     0 0.007034862 0.9738247 1.0000000</span></span>
<span><span class="co">## 5 0.06129069 0.9834495     0 0.008123567 0.9675276 0.9993714</span></span>
<span><span class="co">## 6 0.06271999 0.9792709     0 0.009066121 0.9615017 0.9970402</span></span></code></pre>
<p>More importantly however, we can plot the survival curves directly
using the <code>plot</code> method:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>This plot function comes with many options which are listed in the
documentation. To plot the point-wise confidence intervals, we can set
the argument <code>conf_int</code> to TRUE:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Many more custom settings, such as median survival time indicator
lines, censoring indicator lines and risk tables are available. For more
details and examples see <code><a href="../reference/plot.adjustedsurv.html">?plot.adjustedsurv</a></code> or the
associated vignette, which goes in even more detail on how the plots can
be customized.</p>
</div>
<div class="section level3">
<h3 id="inverse-probability-of-treatment-weighting">Inverse Probability of Treatment Weighting<a class="anchor" aria-label="anchor" href="#inverse-probability-of-treatment-weighting"></a>
</h3>
<p>The <code><a href="../reference/adjustedsurv.html">adjustedsurv()</a></code> function essentially works the same
with every available method. Since the methods are however vastly
different in nature, some additional arguments have to be supplied by
the user. For example, using the Inverse Probability of Treatment
Weighting method (IPTW), we need to model the <em>treatment assignment
mechanism</em> instead of the outcome mechanism (see Xie and Liu
(2005)). This can be done in many ways. Below we use a logistic
regression model for exemplary purposes:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span>,</span>
<span>                       data<span class="op">=</span><span class="va">data_1</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data_1</span>,</span>
<span>                        variable<span class="op">=</span><span class="st">"group"</span>,</span>
<span>                        ev_time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                        event<span class="op">=</span><span class="st">"event"</span>,</span>
<span>                        method<span class="op">=</span><span class="st">"iptw_km"</span>,</span>
<span>                        treatment_model<span class="op">=</span><span class="va">treatment_model</span>,</span>
<span>                        conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The resulting curves can be plotted as before:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Since both methods were used correctly here, there are only slight
differences in the results. Big differences between the two methods
usually indicate that either the outcome model or the
treatment-assignment model are incorrectly specified.</p>
</div>
<div class="section level3">
<h3 id="augmented-inverse-probability-of-treatment-weighting">Augmented Inverse Probability of Treatment Weighting<a class="anchor" aria-label="anchor" href="#augmented-inverse-probability-of-treatment-weighting"></a>
</h3>
<p>Doubly-Robust methods can be helpful in such cases (Ozenne et
al. 2020). The standard Augmented Inverse Probability of Treatment
Weighting estimator utilized both kinds of models at the same time. If
either of the models is correctly specified, the resulting estimates
will be unbiased. It can be used in the same way as the other methods,
only that this time both models have to be supplied. Using the same
models as above we can use the following syntax:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data_1</span>,</span>
<span>                        variable<span class="op">=</span><span class="st">"group"</span>,</span>
<span>                        ev_time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                        event<span class="op">=</span><span class="st">"event"</span>,</span>
<span>                        method<span class="op">=</span><span class="st">"aiptw"</span>,</span>
<span>                        treatment_model<span class="op">=</span><span class="va">treatment_model</span>,</span>
<span>                        outcome_model<span class="op">=</span><span class="va">outcome_model</span>,</span>
<span>                        conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="adjusted-cumulative-incidence-functions">Adjusted Cumulative Incidence Functions<a class="anchor" aria-label="anchor" href="#adjusted-cumulative-incidence-functions"></a>
</h2>
<p>In many situations there are multiple mutually exclusive types of
events instead of just one event. This is formally known as a competing
risks situation. In these situations, survival curves can not be
estimated anymore. However, the cumulative incidence function can be
used instead. Without randomization, these CIFs face the same problems
due to confounding as the survival curves do. Many of the methods to
adjust survival curves for confounders can be used to adjust CIFs in
very similar fashion.</p>
<p>While the computational details and the underlying theory is slightly
different (see Ozenne et al. 2020), the syntax for the R-Package stays
pretty much exactly the same. The only major difference is that instead
of using the <code><a href="../reference/adjustedsurv.html">adjustedsurv()</a></code> function, the
<code><a href="../reference/adjustedcif.html">adjustedcif()</a></code> function should be utilized. Additionally,
the user now also has to specify which event-type is of interest using
the <code>cause</code> argument.</p>
<p>First we need new example data, mirroring the competing risks
situation. We are going to use the <code><a href="../reference/sim_confounded_crisk.html">sim_confounded_crisk()</a></code>
function, which does the same thing as the
<code><a href="../reference/sim_confounded_surv.html">sim_confounded_surv()</a></code> function, but with competing risks
data:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate the data</span></span>
<span><span class="va">data_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_confounded_crisk.html">sim_confounded_crisk</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">300</span><span class="op">)</span></span>
<span><span class="va">data_2</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data_2</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   x1 x2 x3          x4          x5          x6 group       time event</span></span>
<span><span class="co">## 1  1  1  0  0.96216812 -0.66375234  0.65527293     1 0.02085406     0</span></span>
<span><span class="co">## 2  1  1  0 -0.58477811  1.73696566 -0.18714061     1 0.18924205     0</span></span>
<span><span class="co">## 3  1  0  0 -0.33549773  0.52008044  0.08290031     0 0.26288996     2</span></span>
<span><span class="co">## 4  0  1  1 -0.04008865  0.19841348  0.38858944     1 0.08210559     2</span></span>
<span><span class="co">## 5  0  0  1  0.78936972 -0.27545174  0.49322272     1 1.67993934     2</span></span>
<span><span class="co">## 6  0  0  0  0.26001387 -0.03590098  0.86231143     1 1.70000000     0</span></span></code></pre>
<div class="section level3">
<h3 id="direct-standardization-1">Direct Standardization<a class="anchor" aria-label="anchor" href="#direct-standardization-1"></a>
</h3>
<p>Let’s again start with the <em>Direct Standardization</em> method.
Instead of using a simple <code>coxph</code> method, we need to use a
model for the time-to-event process which takes the multiple event-types
into account. One such method is the <em>Cause-Specific
Cox-Regression</em> model. A simple implementation of this model is
contained in the <code>riskRegression</code> R-Package.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcome_model</span> <span class="op">&lt;-</span> <span class="fu">riskRegression</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/riskRegression/man/CSC.html" class="external-link">CSC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/Hist.html" class="external-link">Hist</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> </span>
<span>                                       <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span> <span class="op">+</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">data_2</span><span class="op">)</span></span></code></pre></div>
<p>This model can then be used in a call to the
<code><a href="../reference/adjustedcif.html">adjustedcif()</a></code> function, as shown below:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedcif.html">adjustedcif</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data_2</span>,</span>
<span>                      variable<span class="op">=</span><span class="st">"group"</span>,</span>
<span>                      ev_time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                      event<span class="op">=</span><span class="st">"event"</span>,</span>
<span>                      method<span class="op">=</span><span class="st">"direct"</span>,</span>
<span>                      outcome_model<span class="op">=</span><span class="va">outcome_model</span>,</span>
<span>                      cause<span class="op">=</span><span class="fl">1</span>,</span>
<span>                      conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjcif</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>This shows the confounder-adjusted CIFs for <code>cause = 1</code>.
By setting <code>cause</code> to <code>2</code> we get the
confounder-adjusted CIFs for the other cause:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedcif.html">adjustedcif</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data_2</span>,</span>
<span>                      variable<span class="op">=</span><span class="st">"group"</span>,</span>
<span>                      ev_time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                      event<span class="op">=</span><span class="st">"event"</span>,</span>
<span>                      method<span class="op">=</span><span class="st">"direct"</span>,</span>
<span>                      outcome_model<span class="op">=</span><span class="va">outcome_model</span>,</span>
<span>                      cause<span class="op">=</span><span class="fl">2</span>,</span>
<span>                      conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjcif</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="inverse-probability-of-treatment-weighting-1">Inverse Probability of Treatment Weighting<a class="anchor" aria-label="anchor" href="#inverse-probability-of-treatment-weighting-1"></a>
</h3>
<p>The IPTW estimator can be used exactly the same way as we did with
the <code><a href="../reference/adjustedsurv.html">adjustedsurv()</a></code> function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span>,</span>
<span>                       data<span class="op">=</span><span class="va">data_2</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adjcif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedcif.html">adjustedcif</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data_2</span>,</span>
<span>                      variable<span class="op">=</span><span class="st">"group"</span>,</span>
<span>                      ev_time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                      event<span class="op">=</span><span class="st">"event"</span>,</span>
<span>                      method<span class="op">=</span><span class="st">"iptw"</span>,</span>
<span>                      treatment_model<span class="op">=</span><span class="va">treatment_model</span>,</span>
<span>                      cause<span class="op">=</span><span class="fl">1</span>,</span>
<span>                      conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjcif</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="adjusted-curves-with-more-than-two-groups">Adjusted Curves with More than Two Groups<a class="anchor" aria-label="anchor" href="#adjusted-curves-with-more-than-two-groups"></a>
</h2>
<p>In many applications there are more than two treatments. Some of the
methods included in this R-Package allow calculations for an arbitrary
number of treatments. In these cases the code does not change at all and
can be used exactly in the same way as before. The only difference
occurs when using IPTW methods. Here the user has to use a multinomial
logistic regression model instead of a regular logistic regression to
model the outcome. This is illustrated below.</p>
<p>First we again create a simulated data set (for single event survival
data). The function is only able to create binary treatment variables,
but we can simply resample all occurrences of 1 into 1 and 2, creating 3
treatments, where 1 and 2 have an identical treatment effect and
selection process:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add another group</span></span>
<span><span class="co"># NOTE: this is done only to showcase the method and does not</span></span>
<span><span class="co">#       reflect what should be done in real situations</span></span>
<span><span class="va">data_1</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">data_1</span><span class="op">$</span><span class="va">group</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_1</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="va">data_1</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="st">"1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                                          size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_1</span><span class="op">[</span><span class="va">data_1</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="st">"1"</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The Direct Adjusted survival curves can be calculated exactly as
before:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcome_model</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> </span>
<span>                                   <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span> <span class="op">+</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">data_1</span>, x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data_1</span>,</span>
<span>                        variable<span class="op">=</span><span class="st">"group"</span>,</span>
<span>                        ev_time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                        event<span class="op">=</span><span class="st">"event"</span>,</span>
<span>                        method<span class="op">=</span><span class="st">"direct"</span>,</span>
<span>                        outcome_model<span class="op">=</span><span class="va">outcome_model</span>,</span>
<span>                        conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>For the IPTW based estimates we first fit a multinomial logistic
regression model using the <code>multinom</code> function from the
<code>nnet</code> R-Package and use it with the same code as before:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment_model</span> <span class="op">&lt;-</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span> <span class="op">+</span> <span class="va">x4</span> <span class="op">+</span> <span class="va">x5</span> <span class="op">+</span> <span class="va">x6</span>,</span>
<span>                                  data<span class="op">=</span><span class="va">data_1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # weights:  24 (14 variable)</span></span>
<span><span class="co">## initial  value 329.583687 </span></span>
<span><span class="co">## iter  10 value 286.543657</span></span>
<span><span class="co">## iter  20 value 283.765460</span></span>
<span><span class="co">## final  value 283.765313 </span></span>
<span><span class="co">## converged</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adjsurv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustedsurv.html">adjustedsurv</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">data_1</span>,</span>
<span>                        variable<span class="op">=</span><span class="st">"group"</span>,</span>
<span>                        ev_time<span class="op">=</span><span class="st">"time"</span>,</span>
<span>                        event<span class="op">=</span><span class="st">"event"</span>,</span>
<span>                        method<span class="op">=</span><span class="st">"iptw_km"</span>,</span>
<span>                        treatment_model<span class="op">=</span><span class="va">treatment_model</span>,</span>
<span>                        conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adjsurv</span>, conf_int<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="further-topics">Further Topics<a class="anchor" aria-label="anchor" href="#further-topics"></a>
</h2>
<p>Only a few methods and the most important functionality of this
package were shown in this vignette. It includes a lot more methods and
functionality, which is described in great detail in both the
documentation and the other vignettes of this package.</p>
<div class="section level3">
<h3 id="implemented-methods">Implemented Methods<a class="anchor" aria-label="anchor" href="#implemented-methods"></a>
</h3>
<p>For users who want to learn more about the implemented methods, we
recommend consulting the documentation of the main functions first
(<code><a href="../reference/adjustedsurv.html">?adjustedsurv</a></code> or <code><a href="../reference/adjustedcif.html">?adjustedcif</a></code>). This page
will also guide the user to more detailed method-specific information.
An overview of all implemented methods is given in the associated
vignette
(<code><a href="../articles/method_overview.html">vignette(topic="method_overview", package="adjustedCurves")</a></code>).</p>
</div>
<div class="section level3">
<h3 id="plot-customization">Plot Customization<a class="anchor" aria-label="anchor" href="#plot-customization"></a>
</h3>
<p>The <code><a href="../reference/plot.adjustedsurv.html">plot.adjustedsurv()</a></code> function contains a lot of
arguments to customize the adjusted survival curve plots, which may be
daunting at first. The associated vignette
(<code><a href="../articles/plot_customization.html">vignette(topic="plot_customization", package="adjustedCurves")</a></code>)
describes most of these options in great detail with multiple
examples.</p>
</div>
<div class="section level3">
<h3 id="comparing-groups">Comparing Groups<a class="anchor" aria-label="anchor" href="#comparing-groups"></a>
</h3>
<p>Users may also be interested in formally comparing the (treatment)
groups after adjustment has been made. There are multiple ways to
perform such comparisons using this package for both standard
time-to-event data and data with competing events. A vignette explaining
what these different options are and how to use them is also included in
this package
(<code><a href="../articles/comparing_groups.html">vignette(topic="comparing_groups", package="adjustedCurves")</a></code>).
We recommend consulting this vignette if group comparisons are of
interest.</p>
</div>
<div class="section level3">
<h3 id="faq">FAQ<a class="anchor" aria-label="anchor" href="#faq"></a>
</h3>
<p>Some of the most frequently asked questions are answered in the FAQ
vignette
(<code><a href="../articles/faq.html">vignette(topic="faq", package="adjustedCurves")</a></code>).</p>
</div>
</div>
<div class="section level2">
<h2 id="literature">Literature<a class="anchor" aria-label="anchor" href="#literature"></a>
</h2>
<p>Robin Denz, Renate Klaaßen-Mielke, and Nina Timmesfeld (2023). “A
Comparison of Different Methods to Adjust Survival Curves for
Confounders”. In: Statistics in Medicine 42.10, pp. 1461-1479.</p>
<p>Judea Pearl (2009). Causality: Models, Reasoning and Inference. 2nd
ed. Cambridge: Cambridge University Press</p>
<p>Robert W. Makuch (1982). “Adjusted Survival Curve Estimation Using
Covariates”. In: Journal of Chronic Diseases 35.6, pp. 437-443.</p>
<p>I-Ming Chang, Rebecca Gelman, and Marcello Pagano (1982). “Corrected
Group Prognostic Curves and Summary Statistics”. In: Journal of Chronic
Diseases 35, pp. 669-674.</p>
<p>Jun Xie and Chaofeng Liu (2005). “Adjusted Kaplan-Meier Estimator and
Log-Rank Test with Inverse Probability of Treatment Weighting for
Survival Data”. In: Statistics in Medicine 24, pp. 3089-3110.</p>
<p>Brice Maxime Hugues Ozenne, Thomas Harder Scheike, and Laila Staerk
(2020). “On the Estimation of Average Treatment Effects with
Right-Censored Time to Event Outcome and Competing Risks”. In:
Biometrical Journal 62, pp. 751-763.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
